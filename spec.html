<!DOCTYPE html>
<!-- Built with spec-md https://spec-md.com -->
<html>
<head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1"><title>Argo</title>
<style>@media (prefers-color-scheme: light){:root{--color-foreground: #333333;--color-background: #ffffff;--color-light-grey: #ccc;--color-grey: #666666;--color-white: #fff;--color-link: #3b5998;--color-subsection-link: var(--color-foreground);--color-toc-link: var(--color-foreground);--color-toc-id: var(--color-link);--color-toggle-border: #bbc;--color-sidebar-background: #f0f0f0;--color-sidebar-viewing-link: #8b9;--color-sidebar-toggle-button: rgba(0, 0, 0, .7);--color-sidebar-shadow-inset: rgba(0, 0, 0, .05);--color-sidebar-shadow: rgba(0, 0, 0, .04);--color-sidebar-large-shadow: rgba(0, 0, 0, .08);--color-pre-background: #fafafa;--color-pre-border: #e9e9e9;--color-code-background: rgba(0, 0, 0, .03);--color-spec-todo: var(--color-grey);--color-spec-example: #fafaff;--color-spec-example-border: #bbbbff;--color-spec-counter-example: #fffafa;--color-spec-counter-border: #ffbbbb;--color-spec-counter-example-link: #98593b;--color-spec-added-border: #396;--color-spec-removed-border: #933;--color-spec-prose: var(--color-grey);--color-spec-quantifier-list: var(--color-link);--color-spec-quantifier-optional: #83238e;--color-spec-condition: #1c7758;--color-spec-param: var(--color-grey);--color-spec-rx: var(--color-foreground);--color-spec-note-border: #f4e925;--color-spec-note-background: #fefef3;--color-spec-note-first-link: #6c6613;--color-source-link: var(--color-light-grey);--color-table-header: #f9f9f9;--color-table-header-border: #d0d0d0;--color-token-inserted: hsla(241, 71%, 34%, .69);--color-token-deleted: hsla(324, 92%, 33%, .74);--color-inserts-background: rgba(0, 200, 30, .08);--color-deletions-background: rgba(200, 0, 0, .08);--selection-background-color: #cacee0;--selection-background-color-link: #f0babe}.selection-link:hover{--selection-background-color: #3b5998}}@media (prefers-color-scheme: dark){:root{--color-foreground: #b6b6b6;--color-background: #262626;--color-light-grey: #373737;--color-grey: #828282;--color-white: rgb(29, 29, 29);--color-link: #89b7da;--color-subsection-link: var(--color-foreground);--color-toc-link: var(--color-foreground);--color-toc-id: var(--color-link);--color-toggle-border: #bbc;--color-sidebar-background: #323232;--color-sidebar-viewing-link: #8b9;--color-sidebar-toggle-button: rgba(220, 220, 220, .7);--color-sidebar-shadow-inset: rgba(0, 0, 0, .05);--color-sidebar-shadow: rgba(0, 0, 0, .04);--color-sidebar-large-shadow: rgba(0, 0, 0, .08);--color-pre-background: #2e2e2e;--color-pre-border: #3a3a3a;--color-code-background: rgba(41, 41, 41, .03);--color-spec-todo: var(--color-grey);--color-spec-example: #2b2b35;--color-spec-example-border: #4d4d6d;--color-spec-counter-example: #322828;--color-spec-counter-border: #664040;--color-spec-counter-example-link: #ff702d;--color-spec-added-border: #396;--color-spec-removed-border: #933;--color-spec-prose: var(--color-grey);--color-spec-quantifier-list: var(--color-link);--color-spec-quantifier-optional: #c689ce;--color-spec-condition: #6fa889;--color-spec-param: var(--color-grey);--color-spec-rx: var(--color-foreground);--color-spec-note-border: #605e39;--color-spec-note-background: #303028;--color-spec-note-first-link: #f0e330;--color-source-link: var(--color-grey);--color-table-header: #373737;--color-table-header-border: #525252;--color-token-inserted: hsla(241, 63%, 70%, .69);--color-token-deleted: hsla(325, 64%, 67%, .74);--color-inserts-background: rgba(0, 200, 30, .08);--color-deletions-background: rgba(200, 0, 0, .08);--selection-background-color: #656565;--selection-background-color-link: #f0babe}.selection-link:hover{--selection-background-color: #829edb}}:root{color:var(--color-foreground);background-color:var(--color-background);font-family:var(--font-family);font-size:15px;line-height:1.5;--mono-font-size: 13px;--indent: 1rem;--list-indent: 1.5rem;--dfn-indent: 0rem;--font-family: Cambria, "Palatino Linotype", Palatino, "Liberation Serif", serif;--font-family-monospace: Consolas, Monaco, "Andale Mono", "Ubuntu Mono", monospace}@media (min-width: 720px){:root{font-size:17px;--mono-font-size: 15px;--indent: 2rem;--list-indent: 2rem;--dfn-indent: 2rem}}body{margin:3rem 0 3rem}article{margin:0 1rem}@media (min-width: 720px){body{margin:6rem auto 3rem;max-width:800px;padding-left:75px;padding-right:clamp(0px,calc((100vw - 800px) * .25),75px)}}.source-link{display:none}@media screen and (min-width: 720px){.source-link{display:block;position:absolute;width:18px;fill:var(--color-source-link);opacity:.3}.source-link:hover{opacity:1}}.outdated-selection-link,.selection-link{position:absolute;display:block;color:var(--color-white);background:var(--selection-background-color);border-radius:4px;font-size:36px;height:23px;line-height:48px;text-align:center;text-decoration:none;width:25px;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.outdated-selection-link:hover,.selection-link:hover{text-decoration:none}.outdated-selection-link:before,.selection-link:before{border:5px solid transparent;content:"";height:0;margin-top:-5px;margin-right:-5px;position:absolute;right:1px;top:50%;width:0}@media (max-width: 719px){.outdated-selection-link:before,.selection-link:before{border-bottom-color:var(--selection-background-color);border-top:0;right:50%;top:1px}}@media (min-width: 720px){.outdated-selection-link:before,.selection-link:before{border-left-color:var(--selection-background-color);border-right:0;right:1px;top:50%}}.outdated-selection-link{background:var(--selection-background-color-link);font-size:21px;font-weight:800;line-height:27px}.outdated-selection-link:hover:after{content:"This selection content has changed since this link was created.";font:9pt/11pt var(--font-family);position:absolute;display:block;white-space:nowrap;padding:2px 5px 1px;top:-20px;background:black;color:var(--color-white)}a{color:var(--color-link);text-decoration:none}a:hover{text-decoration:underline}img{max-width:100%}dl{margin:1rem 0 1rem var(--dfn-indent)}dd{margin:.25em 0 .5em var(--indent)}dd+dd{margin-top:1rem}dfn,.spec-ref{font-style:italic}dfn>a,.spec-ref>a{color:inherit}h1,h2,h3,h4,h5,h6{font-weight:bold;margin:3em 0 1em;position:relative}@media (min-width: 720px){header>h1{margin:6em 0 3em}}h1{font-size:1.5em;margin-top:5em}h2,h3{font-size:1.25em}h4,h5,h6{font-size:1em}section{padding-top:1rem;margin-top:-1rem}section.subsec>h6{margin-top:2em}section.subsec>h6>a{color:var(--color-subsection-link)}section .spec-secid{margin-right:1ex}@media (min-width: 720px){section .spec-secid{position:absolute;right:100%;text-align:right;white-space:nowrap}}footer{font-size:75%;opacity:.5;text-align:center;margin-top:12rem}.spec-toc{margin:1rem 0 3rem}.spec-toc .title{content:"Contents";display:block;font-weight:bold;margin:5em 0 1em}.spec-toc .spec-secid{margin-right:1ex}.spec-toc ol{list-style:none;padding-left:0;margin-top:0;margin-bottom:0}.spec-toc ol ol{list-style:none;padding-left:2ex;margin-bottom:.25em}.spec-toc li{position:relative;padding:5px 0 0 30px;margin:-5px 0 0 -30px}.spec-toc a{color:var(--color-toc-link)}.spec-toc a:hover{text-decoration:none}.spec-toc a .spec-secid{color:var(--color-toc-id)}.spec-toc a:hover .spec-secid{text-decoration:underline}.spec-toc .toggle{display:none}.spec-toc .toggle+label{cursor:pointer;left:6px;opacity:1;padding:5px 6px 5px 7px;position:absolute;top:6px;transform:rotate(0deg);transition:all .18s ease-in-out}.spec-toc .toggle+label:after{border-color:transparent transparent transparent var(--color-toggle-border);border-style:solid;border-width:6px 0 6px 7px;content:" ";display:block;height:0;width:0}@media (pointer: fine){.spec-toc .toggle+label{left:10px;padding:3px 5px 3px 6px;top:8px}}.spec-toc .toggle:checked+label{transform:rotate(90deg)}@media (hover: hover){.spec-toc li:not(:hover)>.toggle:checked+label{opacity:0}}.spec-toc .toggle:not(:checked)~ol{max-height:0;overflow:hidden;margin:0}.spec-sidebar-toggle{display:none}.spec-sidebar-toggle+label>.spec-sidebar-button{position:fixed;right:0;top:0;padding:10px 15px;font-size:30px;color:var(--color-sidebar-toggle-button);z-index:2;cursor:pointer;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.spec-sidebar-toggle:checked+label:after{content:"";position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:0}.spec-sidebar{display:none;position:fixed;right:0;top:0;width:min(320px,calc(100vw - 48px));font-size:14px;line-height:1.75;overflow-y:scroll;height:100%;padding:0 0 5rem 30px;box-sizing:border-box;background:var(--color-sidebar-background);box-shadow:inset 1px 0 var(--color-sidebar-shadow-inset),-4px 0 8px -2px var(--color-sidebar-shadow);overscroll-behavior:contain}.spec-sidebar{user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.spec-sidebar-toggle:checked~.spec-sidebar{display:block}.spec-sidebar .viewing>a:after{color:var(--color-sidebar-viewing-link);content:"\2022";margin-left:1ex}@media (min-width: 1220px){.spec-sidebar-toggle+label{display:none}.spec-sidebar{display:block;box-shadow:inset 1px 0 var(--color-sidebar-shadow-inset),inset 4px 0 8px -2px var(--color-sidebar-large-shadow)!important}body{padding-right:345px}}.spec-note{background:var(--color-spec-note-background);border-left:solid 4px var(--color-spec-note-border);margin:1rem -1rem;min-width:70vw;padding:8px 1rem 12px calc(1rem - 4px);width:-moz-fit-content;width:-webkit-fit-content;width:fit-content}@media (min-width: 720px){.spec-note{min-width:416px}}.spec-note>a:first-child{color:var(--color-spec-note-first-link);display:block;font:italic 11pt/18pt var(--font-family);opacity:.6;user-select:none}.spec-todo{color:var(--color-spec-todo);margin:1em 0 1em 5em;min-height:1em}.spec-todo::before{content:"todo";display:block;float:left;margin-left:-5em;text-transform:uppercase}.spec-index ol{list-style-type:none;margin:0 0 0 var(--indent);padding:0;column-width:210px;column-gap:var(--indent)}.spec-index ol li{width:min-content;white-space:nowrap}pre,code{font-family:var(--font-family-monospace);font-size:var(--mono-font-size);font-weight:inherit}code{background:var(--color-code-background);margin:-2px -1px;padding:3px 3px;white-space:pre-wrap}pre>code{background:none;font-weight:inherit;margin:0;padding:0;white-space:pre}pre{background:var(--color-pre-background);border-left:solid 4px var(--color-pre-border);margin:1rem -1rem;min-width:70vw;padding:12px 1rem 12px calc(1rem - 4px);width:-moz-fit-content;width:-webkit-fit-content;width:fit-content;max-width:calc(100vw - 2rem);overflow-y:auto}@media (min-width: 720px){pre{min-width:40ch}}.spec-example{background:var(--color-spec-example);border-left:solid 4px var(--color-spec-example-border);padding-top:8px}.spec-counter-example{background:var(--color-spec-counter-example);border-left:solid 4px var(--color-spec-counter-border);padding-top:8px}.spec-example>a,.spec-counter-example>a{display:block;font:italic 11pt/18pt var(--font-family);opacity:.6;user-select:none}.spec-counter-example>a{color:var(--color-spec-counter-example-link)}table{border-collapse:collapse}th{background-color:var(--color-table-header)}td,th{border:1px solid var(--color-table-header-border);padding:.4em;vertical-align:baseline}ol,ul{padding-left:var(--list-indent)}li>ol,li>ul{margin-top:.25em;margin-bottom:.5em}li+li{margin-top:.25em}li.task{list-style-type:none;position:relative}li.task>input:first-child{margin-left:0;position:absolute;transform:translateX(calc(-100% - 1ch))}ins{background-color:var(--color-inserts-background);text-decoration:none}del{background-color:var(--color-deletions-background)}.spec-added,.spec-removed{border-left:4px solid;margin-left:-18px;padding-left:14px}.spec-added{border-color:var(--color-spec-added-border)}.spec-removed{border-color:var(--color-spec-removed-border);text-decoration:line-through}.spec-keyword{font-weight:bold}.spec-string{font-family:var(--font-family-monospace);font-size:85%;white-space:pre}var{font-style:italic}*[data-name]{transition:.15s background ease-out;border-radius:2px;padding:0 3px;margin:0 -3px}.spec-semantic,.spec-algo{margin:1rem 0 1rem var(--dfn-indent)}.spec-semantic>.spec-nt::after,.spec-algo>.spec-call:first-child::after{content:":";font-style:normal;font-weight:bold;margin-left:1ex}.spec-semantic ol,.spec-semantic ol ol ol ol,.spec-algo ol,.spec-algo ol ol ol ol{list-style-type:decimal}.spec-semantic ol ol,.spec-semantic ol ol ol ol ol,.spec-algo ol ol,.spec-algo ol ol ol ol ol{list-style-type:lower-alpha}.spec-semantic ol ol ol,.spec-semantic ol ol ol ol ol ol,.spec-algo ol ol ol,.spec-algo ol ol ol ol ol ol{list-style-type:lower-roman}.spec-call>a{color:inherit}.spec-production{margin:1rem 0 1rem var(--dfn-indent)}.spec-production>.spec-nt::after{content:":";font-style:normal;font-weight:bold;margin:0 1ex}.spec-semantic.d2>.spec-nt::after,.spec-production.d2>.spec-nt::after{content:"::"}.spec-semantic.d3>.spec-nt::after,.spec-production.d3>.spec-nt::after{content:":::"}.spec-production>.spec-rhs{line-height:1.1;margin:.25em 0 .5em calc(2 * var(--indent));text-indent:calc(-1 * var(--indent))}.spec-semantic>.spec-rhs{display:inline-block;text-indent:calc(-1 * var(--indent));margin-left:calc(1ex + var(--indent))}.spec-rhs>*{text-indent:0}.spec-oneof{display:inline}.spec-oneof::before{content:"one of";font-style:normal;font-weight:bold}.spec-oneof-grid{max-width:calc(100vw - 2rem);overflow:auto;margin:-1ex -1rem;padding:1ex 1rem}.spec-oneof-grid>table{margin-left:var(--indent)}.spec-oneof .spec-rhs{border:none;margin:0;padding:0 0 0 1rem;vertical-align:baseline;white-space:pre}.spec-oneof .spec-rhs:first-child{padding:0}.spec-rhs .spec-constrained:not(:first-child),.spec-rhs .spec-quantified:not(:first-child),.spec-rhs .spec-nt:not(:first-child),.spec-rhs .spec-t:not(:first-child),.spec-rhs .spec-rx:not(:first-child),.spec-rhs .spec-prose:not(:first-child),.spec-rhs .spec-empty:not(:first-child),.spec-rhs .spec-lookahead:not(:first-child){margin-left:1ex;display:inline-block}.spec-condition{font-size:85%}.spec-condition::before{content:"[if "}.spec-condition.not::before{content:"[if not "}.spec-condition::after{content:"]"}.spec-empty,.spec-prose{color:var(--color-spec-prose)}.spec-nt{font-style:italic}.spec-nt>a{color:inherit}.spec-quantifiers,.spec-params{font-size:65%;font-style:normal;vertical-align:sub}.spec-quantifier.list{color:var(--color-spec-quantifier-list)}.spec-quantifier.optional{color:var(--color-spec-quantifier-optional)}.spec-params,.spec-condition{color:var(--color-spec-condition)}.spec-params::before{content:"["}.spec-params::after{content:"]"}.spec-quantifier:not(:last-child)::after,.spec-param:not(:last-child)::after{color:var(--color-spec-param);content:", "}.spec-param.conditional::before{content:"?"}.spec-param.negated::before{content:"!"}.spec-t,.spec-rx{color:var(--color-spec-rx);font-family:var(--font-family-monospace);font-weight:bold}.spec-butnot::before{color:var(--color-grey);content:"but not";font-family:var(--font-family);font-weight:normal;margin-right:1ex}.spec-butnot>*:not(:first-child)::before{color:var(--color-grey);content:"or";font-family:var(--font-family);font-weight:normal;margin-right:1ex}.spec-rhs .spec-oneof::before,.spec-rhs .spec-butnot::before{margin-left:1ex}.spec-lookahead>*{margin:0!important}.spec-lookahead>*:not(:first-child)::before{color:var(--color-grey);content:", ";font-family:var(--font-family);font-style:normal;font-weight:normal}.spec-lookahead::before{color:var(--color-grey);content:"[lookahead = ";font-family:var(--font-family);font-style:normal;font-weight:normal}.spec-lookahead.not::before{content:"[lookahead \2260  "}.spec-lookahead.set::before{content:"[lookahead \2208  {";margin-right:0}.spec-lookahead.set.not::before{content:"[lookahead \2209  {"}.spec-lookahead.ntset::before{content:"[lookahead \2208  ";margin-right:0}.spec-lookahead.ntset.not::before{content:"[lookahead \2209  "}.spec-lookahead::after{color:var(--color-grey);content:"]"}.spec-lookahead.set::after{content:"}]"}code[class*=language-],pre[class*=language-]{color:var(--color-prism-foreground);background:none;text-shadow:0 1px var(--color-prism-text-shadow);font-family:var(--font-family-monospace);font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection{text-shadow:none;background:var(--color-prism-background)}pre[class*=language-]::selection,pre[class*=language-] ::selection,code[class*=language-]::selection,code[class*=language-] ::selection{text-shadow:none;background:var(--color-prism-background)}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:var(--color-prism-block-background)}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.atrule,.token.attr-value,.token.keyword,.token.property,.token.selector,.token.attr-name,.token.builtin,.token.entity,.token.url,.token.inserted{color:var(--color-token-inserted);background:none}.token.tag,.token.boolean,.token.number,.token.string,.token.char,.token.constant,.token.symbol,.token.regex,.token.important,.token.variable,.token.function,.token.class-name,.token.deleted{color:var(--color-token-deleted)}.token.comment,.token.prolog,.token.doctype,.token.cdata,.token.description{color:inherit;opacity:.3}.token.punctuation{color:inherit;opacity:.5}.token.operator,.token.namespace{color:inherit;opacity:.7}</style>
<script>(function(){var r,a=[];document.addEventListener("readystatechange",function(){document.readyState==="interactive"&&u()});function u(){var n=document.querySelector('label[for="spec-sidebar-toggle"]');n.addEventListener("scroll",o),n.addEventListener("touchmove",o);function o(d){d.preventDefault()}for(var t=document.getElementsByTagName("section"),e=0;e<t.length;e++)t[e].getAttribute("secid")&&a.push(t[e]);var i=window.scrollY,c=!1;window.addEventListener("scroll",function(d){i=window.scrollY,c||(c=!0,window.requestAnimationFrame(function(){s(i),c=!1}))})}function s(n){for(var o=n+document.documentElement.clientHeight/4,t,e=a.length-1;e>=0;e--)if(a[e].offsetTop<o){t=a[e];break}var i=t&&t.getAttribute("secid");i!==r&&(r&&l(r,!1),i&&l(i,!0),r=i)}function l(n,o){document.getElementById("_sidebar_"+n).className=o?"viewing":"";for(var t=n.split(".");t.length;){var e=document.getElementById("_toggle_"+t.join("."));e&&(e.checked=o),t.pop()}}s(window.scrollY);})();</script>
<script>(function(){var n=document.getElementsByTagName("style")[0].sheet,e;function u(){e&&(n.deleteRule(e),e=void 0)}function d(t){u(),e=n.insertRule('*[data-name="'+t+'"] { background: rgba(230,215,0,0.12); }',n.cssRules.length)}document.documentElement.addEventListener("mouseover",function(t){var a=t.target.attributes["data-name"];a&&d(a.value)});document.documentElement.addEventListener("mouseout",u);})();</script>
<script>(function(){var R="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",o,p,r,g;document.addEventListener("selectionchange",E);window.addEventListener("resize",C);window.addEventListener("hashchange",x);window.addEventListener("load",x);function S(n){y(new URL(n.target.href))}function x(){y(window.location)}function y(n){var e=n.hash.match(/^#sel-([A-Za-z0-9-_]+)$/);if(!!e){g=e[1],r=k(g);var t=r.getBoundingClientRect(),d=Math.max(20,Math.floor((window.innerHeight-t.height)*.4));window.scrollTo(0,window.scrollY+t.y-d);var c=document.getSelection();c.empty(),c.addRange(r),C()}}function E(n){var e=document.getSelection();if(e.isCollapsed)o&&(o.parentNode.removeChild(o),o=null);else{var t=e.getRangeAt(0);(!r||t.compareBoundaryPoints(Range.START_TO_START,r)!==0||t.compareBoundaryPoints(Range.END_TO_END,r)!==0)&&(r=t,g=B(r),C())}}function C(){if(!!r){p||(p=document.getElementsByTagName("article")[0]),o||(o=document.createElement("a"),document.body.appendChild(o)),o.href="#sel-"+g,o.onclick=S,o.className=r.isOutdated?"outdated-selection-link":"selection-link",o.innerText=r.isOutdated?"!":"\u201F";var n=window.innerWidth<720,e=r.getBoundingClientRect();if(n)o.style.left=Math.floor(e.x+e.width/2+window.scrollX-13)+"px",o.style.top=Math.floor(e.bottom+window.scrollY+10)+"px";else{var t=p.getBoundingClientRect().x;o.style.left=Math.floor(t+window.scrollX-37)+"px",o.style.top=Math.floor(e.y+window.scrollY-3)+"px"}}}function B(n){var e="",t=N(n.startContainer),d=N(n.endContainer),c=M(t,d);return l(c),l(t.slice(c.length).concat(n.startOffset)),l(d.slice(c.length).concat(n.endOffset)),i(L(n.toString())),e;function i(a){do e+=R[a&31|(a>31?32:0)],a>>=5;while(a>0)}function l(a){i(a.length);for(var h=0;h<a.length;h++)i(a[h])}}function k(n){for(var e=new Array(64),t=0;t<64;t++)e[R.charCodeAt(t)]=t;var d=0,c=m(),i=m(),l=m(),a=w(),h=i.pop(),P=O(c.concat(i)),T=l.pop(),A=O(c.concat(l)),u=document.createRange();return u.setStart(P,h),u.setEnd(A,T),u.isOutdated=a!==void 0&&a!==L(u.toString()),u;function w(){for(var s=0,v=0;d<n.length;){var f=e[n.charCodeAt(d++)];if(s|=(f&31)<<v,v+=5,f<32)return s}}function m(){var s=w();if(s!=null){for(var v=new Array(s),f=0;f<s;f++)v[f]=w();return v}}}function N(n){for(var e=[];n!=document.body;){var t=n.parentNode;e.push(Array.prototype.indexOf.call(t.childNodes,n)),n=t}return e.reverse()}function O(n){for(var e=document.body,t=0;t<n.length&&e;t++)e=e.childNodes[n[t]];return e}function M(n,e){for(var t=0;t<n.length&&t<e.length&&n[t]===e[t];)t++;return n.slice(0,t)}function L(n){for(var e=2166136261,t=0;t<n.length;++t)e^=n.charCodeAt(t),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return(e>>15^e)&32767}})();</script>
</head>
<body><article>
<header>
<h1>Argo</h1>
<section id="intro">
<p><em>Version 0.0.1 DRAFT</em>. <em>Compatible with <a href="https://spec.graphql.org/October2021">GraphQL October 2021 Edition</a>.</em></p>
<p>Argo is a compact and compressible binary serialization format for <a href="https://graphql.org">GraphQL</a>. It aims to:</p>
<ul>
<li><strong>Minimize end-to-end latency</strong> of GraphQL responses<ul>
<li>Including serialization, transport, and deserialization</li>
</ul>
</li>
<li><strong>Minimize bytes on the wire</strong>, with and without external compression</li>
<li>Be <strong>easy to implement</strong></li>
</ul>
<p>Argo:</p>
<ul>
<li><strong>Takes the place of JSON</strong> in GraphQL responses</li>
<li>Usually <strong>meets the needs of mobile clients</strong> (and server clients) better than web clients</li>
<li><strong>Works best with code generation</strong>, but also works well with interpretation</li>
<li>Does not currently support GraphQL Input types</li>
</ul>
<p>---</p>
<ul>
<li>compute wire schema</li>
<li>encode</li>
<li>decode</li>
</ul>
<div class="spec-todo">
:</div>
<ul>
<li>document: null collapsing. nullable fields would normally start w/ a zero byte if null, 1 otherwise. for enum &amp; union types, this could be collapsed into just the length, if we never used 0 in the type of an enum or union. is that worth it?</li>
<li>Document: defend against invalid back references (too low ids)</li>
<li>Document: limit read length allocations which exceed content size (if known) or a configurable limit, default 64MB</li>
<li>Document: never backref empty string? or more generally, when encoding, check if backref length + value &le; backref id size. &ndash;</li>
<li>Document: Adding an enum: can&rsquo;t produce a reliable tag based on ordering, if the server adds a new enum value before the end, or removes one entirely</li>
<li>Document: why not input types.</li>
</ul>
<section id="sec--Introduction-" class="subsec">
<h6><a href="#sec--Introduction-" title="link to this subsection"> Introduction </a></h6>
<p>This document defines Argo. It is intended to be the authoritative specification. Implementations of Argo must adhere to this document.</p>
<p><a href="#sec-Design-notes">Design notes</a> and <a href="#sec-Motivation">motivations</a> are included, but these sections do not specify necessary technical details.</p>
</section>
</section>
<nav class="spec-toc">
<div class="title">Contents</div>
<ol>
<li><a href="#sec-Overview"><span class="spec-secid">1</span>Overview</a><ol>
<li><a href="#sec-Argo-actions-at-Registration-Time"><span class="spec-secid">1.1</span>Argo actions at Registration Time</a><ol>
<li><a href="#sec-Registration-time-algorithm"><span class="spec-secid">1.1.1</span>Registration time algorithm</a></li>
</ol>
</li>
<li><a href="#sec-Argo-actions-at-Execution-Time"><span class="spec-secid">1.2</span>Argo actions at Execution Time</a></li>
</ol>
</li>
<li><a href="#sec-Types"><span class="spec-secid">2</span>Types</a><ol>
<li><a href="#sec-GraphQL-types"><span class="spec-secid">2.1</span>GraphQL types</a></li>
<li><a href="#sec-Response-types"><span class="spec-secid">2.2</span>Response types</a></li>
<li><a href="#sec-Wire-types"><span class="spec-secid">2.3</span>Wire types</a><ol>
<li><a href="#sec-Self-describing-types"><span class="spec-secid">2.3.1</span>Self-describing types</a></li>
</ol>
</li>
</ol>
</li>
<li><a href="#sec-Wire-schema"><span class="spec-secid">3</span>Wire schema</a><ol>
<li><a href="#sec-Wire-schema-serialization"><span class="spec-secid">3.1</span>Wire schema serialization</a></li>
</ol>
</li>
<li><a href="#sec-Binary-encoding"><span class="spec-secid">4</span>Binary encoding</a><ol>
<li><a href="#sec-Message"><span class="spec-secid">4.1</span>Message</a></li>
<li><a href="#sec-Header"><span class="spec-secid">4.2</span>Header</a></li>
<li><a href="#sec-Blocks"><span class="spec-secid">4.3</span>Blocks</a></li>
<li><a href="#sec-Core"><span class="spec-secid">4.4</span>Core</a></li>
<li><a href="#sec-Label"><span class="spec-secid">4.5</span>Label</a><ol>
<li><a href="#sec-Primitive-Types"><span class="spec-secid">4.5.1</span>Primitive Types</a><ol>
<li><a href="#sec-Self-describing-encoding"><span class="spec-secid">4.5.1.1</span>Self-describing encoding</a></li>
</ol>
</li>
</ol>
</li>
<li><a href="#sec-Backreferences"><span class="spec-secid">4.6</span>Backreferences</a><ol>
<li><a href="#sec-Write-side"><span class="spec-secid">4.6.1</span>Write-side</a></li>
<li><a href="#sec-Read-side"><span class="spec-secid">4.6.2</span>Read-side</a></li>
<li><a href="#sec-Types-which-support-backreferences"><span class="spec-secid">4.6.3</span>Types which support backreferences</a></li>
<li><a href="#sec-Disabling-backreferences-for-a-given-type-in-a-message"><span class="spec-secid">4.6.4</span>Disabling backreferences for a given type in a message</a></li>
</ol>
</li>
<li><a href="#sec-Complex-types"><span class="spec-secid">4.7</span>Complex types</a></li>
<li><a href="#sec-Nullable-types"><span class="spec-secid">4.8</span>Nullable types</a></li>
<li><a href="#sec-Objects"><span class="spec-secid">4.9</span>Objects</a></li>
<li><a href="#sec-Enums"><span class="spec-secid">4.10</span>Enums</a></li>
<li><a href="#sec-Lists"><span class="spec-secid">4.11</span>Lists</a></li>
<li><a href="#sec-Unions"><span class="spec-secid">4.12</span>Unions</a></li>
<li><a href="#sec-Fixed"><span class="spec-secid">4.13</span>Fixed</a></li>
<li><a href="#sec-Errors"><span class="spec-secid">4.14</span>Errors</a></li>
</ol>
</li>
<li><a href="#sec-Motivation"><span class="spec-secid">5</span>Motivation</a><ol>
<li><a href="#sec-JSON"><span class="spec-secid">5.1</span>JSON</a></li>
<li><a href="#sec-Tradeoffs"><span class="spec-secid">5.2</span>Tradeoffs</a></li>
<li><a href="#sec-Argo"><span class="spec-secid">5.3</span>Argo</a></li>
<li><a href="#sec-Recommendation"><span class="spec-secid">5.4</span>Recommendation</a></li>
</ol>
</li>
<li><a href="#sec-Design-notes"><span class="spec-secid">6</span>Design notes</a><ol>
<li><a href="#sec-Ideas-which-did-not-pan-out"><span class="spec-secid">6.1</span>Ideas which did not pan out</a></li>
<li><a href="#sec-Ideas-which-were-not-pursued"><span class="spec-secid">6.2</span>Ideas which were not pursued</a></li>
</ol>
</li>
<li><a href="#sec-Legal"><span class="spec-secid">7</span>Legal</a><ol>
<li><a href="#sec-Copyright-notice"><span class="spec-secid">7.1</span>Copyright notice</a></li>
<li><a href="#sec-License"><span class="spec-secid">7.2</span>License</a></li>
</ol>
</li>
<li><a href="#sec-Formal"><span class="spec-secid">8</span>Formal</a><ol>
<li><a href="#sec-Conformance"><span class="spec-secid">8.1</span>Conformance</a></li>
<li><a href="#sec-Versioning"><span class="spec-secid">8.2</span>Versioning</a></li>
</ol>
</li>
<li><a href="#sec-Authors-and-contributors"><span class="spec-secid">9</span>Authors and contributors</a></li>
<li><a href="#index"><span class="spec-secid">§</span>Index</a></li>
</ol>
</nav>
</header>
<section id="sec-Overview" secid="1">
<h1><span class="spec-secid" title="link to this section"><a href="#sec-Overview">1</a></span>Overview</h1>
<p>Argo is designed to work with GraphQL queries and schemas which are known in advance, but executed many times.</p>
<p>In advance, Argo walks over a given GraphQL query against a particular GraphQL schema and generates a <span class="spec-ref"><a href="#wire-schema" data-name="wire-schema">Wire schema</a></span> which captures type and serialization information which will be used when [de]serializing a response. Later, when serializing a GraphQL response, Argo relies on this and does not need to send this information over the network&mdash;this reduces the payload size. Similarly when deserializing, each client relies on the Wire schema to read the message.</p>
<p>The serialization format itself is a compact binary format which uses techniques to minimize the payload size, make it unusually compressible (to further reduce the payload size over the network), permit high-performance implementations, and remain relatively simple. These techniques include:</p>
<ul>
<li>Integers are written in a compact variable-length format</li>
<li>Scalar values are written into contiguous blocks to improve their compressibility</li>
<li>Many scalar values are deduplicated</li>
<li>Many scalars (particularly strings and byte strings) permit zero-copy implementations</li>
</ul>
<p>Argo separates its work into two phases: <span class="spec-ref"><a href="#registration-time" data-name="registration-time">Registration Time</a></span> and <em>Execution Time.</em></p>
<p><dfn id="registration-time"><a href="#registration-time" data-name="registration-time">Registration Time</a></dfn> happens once, before a payload is serialized with Argo. On a mobile client, Registration Time is typically compile time. On a server, Registration Time is typically when a query is registered by a client application (perhaps whenever a new client version is compiled).</p>
<p><dfn id="execution-time"><a href="#execution-time" data-name="execution-time">Execution Time</a></dfn> happens many times, whenever a payload is [de]serialized with Argo. This relies on information generated during Registration Time.</p>
<div id="note-24ce0" class="spec-note">
<a href="#note-24ce0">Note</a>
Nothing prevents running Registration Time and Execution Time steps at Execution Time. However, this is a low-performance pattern, and is most likely only useful during development.</div>
<p>At Registration Time, Argo generates a <span class="spec-ref"><a href="#wire-schema" data-name="wire-schema">Wire schema</a></span> on both the server and the client. Optionally, code may be generated at Registration Time (based on the Wire schema) to decode messages. At Execution Time, Argo relies on the Wire schema (or code previously generated based on it) to read a binary message.</p>
<section id="sec-Argo-actions-at-Registration-Time" secid="1.1">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Argo-actions-at-Registration-Time">1.1</a></span>Argo actions at Registration Time</h2>
<p>Argo is designed to work with GraphQL queries and schemas which are known in advance. It generates a description of the types which may be returned by a query (one time), and uses this to serialize or deserialize (many times). This description is called a <span class="spec-ref"><a href="#wire-schema" data-name="wire-schema">wire schema</a></span>.</p>
<p>A wire schema is generated by the following high-level algorithm.</p>
<section id="sec-Registration-time-algorithm" secid="1.1.1">
<h3><span class="spec-secid" title="link to this section"><a href="#sec-Registration-time-algorithm">1.1.1</a></span>Registration time algorithm</h3>
<p>Given a GraphQL <code>schema</code>, and a GraphQL <code>query</code> on it:</p>
<div class="spec-algo" id="ArgoAlgorithm()">
<span class="spec-call"><a href="#ArgoAlgorithm()" data-name="ArgoAlgorithm">ArgoAlgorithm</a>(<var data-name="schema">schema</var>, <var data-name="query">query</var>)</span><ol>
<li>Walk over the <code>schema</code> to get each type. At each <code>type</code>:<ol>
<li>Produce a corresponding <a href="#sec-Wire-types">wire type</a>, accounting for any <code>@ArgoCodec</code> or <code>@ArgoDeduplicate</code> directives</li>
</ol>
</li>
<li>Store the resulting <span class="spec-ref"><a href="#wire-schema" data-name="wire-schema">wire schema</a></span></li>
<li>Walk over the <code>query</code> to get the type of everything selected. At each selection, look up the corresponding wire type in the wire schema produced above:<ol>
<li>For each selection set, produce a new wire type which is a subset of the selected object <code>type</code>s</li>
<li>For leaf selections, copy the corresponding wire type</li>
</ol>
</li>
<li>Return the <code>wire schema</code></li>
</ol>
</div>
</section>
</section>
<section id="sec-Argo-actions-at-Execution-Time" secid="1.2">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Argo-actions-at-Execution-Time">1.2</a></span>Argo actions at Execution Time</h2>
<div class="spec-todo">
</div>
</section>
</section>
<section id="sec-Types" secid="2">
<h1><span class="spec-secid" title="link to this section"><a href="#sec-Types">2</a></span>Types</h1>
<p>GraphQL uses two type systems:</p>
<ul>
<li><span class="spec-ref"><a href="#graphql-types" data-name="graphql-types">GraphQL types</a></span>, which may appear in any given GraphQL Schema</li>
<li><span class="spec-ref"><a href="#response-types" data-name="response-types">Response types</a></span>, which are used when serializing responses</li>
</ul>
<p>Argo uses these and introduces:</p>
<ul>
<li><span class="spec-ref"><a href="#wire-types" data-name="wire-types">Wire types</a></span>, used when [de]serializing to or from byte streams</li>
<li><span class="spec-ref"><a href="#self-describing-types" data-name="self-describing-types">Self-describing types</a></span>, primarily used when [de]serializing errors</li>
</ul>
<section id="sec-GraphQL-types" secid="2.1">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-GraphQL-types">2.1</a></span>GraphQL types</h2>
<p><dfn id="graphql-types"><a href="#graphql-types" data-name="graphql-types">GraphQL types</a></dfn> refers to the <a href="https://spec.graphql.org/October2021/#sec-Types">types defined in the GraphQL spec</a>. Briefly, these are:</p>
<ul>
<li><code>Scalar</code>, <code>Enum</code>, <code>Object</code>, <code>Input Object</code>, <code>Interface</code>, <code>Union</code>, <code>List</code></li>
<li>Scalar includes, at minimum: <code>Int</code>, <code>Float</code>, <code>String</code>, <code>Boolean</code>, <code>ID</code></li>
</ul>
<p>GraphQL also allows for <a href="https://spec.graphql.org/October2021/#sec-Scalars.Custom-Scalars">custom scalars</a>. Argo supports this, though a <code>@ArgoCodec</code> directive is required to tell Argo how to represent it on the wire.</p>
</section>
<section id="sec-Response-types" secid="2.2">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Response-types">2.2</a></span>Response types</h2>
<p><dfn id="response-types"><a href="#response-types" data-name="response-types">Response types</a></dfn> refers to the <a href="https://spec.graphql.org/October2021/#sec-Serialization-Format">serialization types sketched in the GraphQL spec</a>. These do not have rigorous definitions in the GraphQL spec. These include (but are not limited to):</p>
<ul>
<li><code>Map</code>, <code>List</code>, <code>String</code>, <code>Null</code></li>
<li>Optionally, <code>Boolean</code>, <code>Int</code>, <code>Float</code>, and <code>Enum Value</code></li>
</ul>
</section>
<section id="sec-Wire-types" secid="2.3">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Wire-types">2.3</a></span>Wire types</h2>
<p><dfn id="wire-types"><a href="#wire-types" data-name="wire-types">Wire types</a></dfn> are used by Argo to encode GraphQL values as bytes.</p>
<ul>
<li><code>STRING</code>: a UTF-8 string</li>
<li><code>BOOLEAN</code>: true or false</li>
<li><code>VARINT</code>: a variable-length integer</li>
<li><code>FLOAT64</code>: an IEEE 754 double-precision binary floating-point (binary64)</li>
<li><code>BYTES</code>: a variable-length byte string</li>
<li><code>FIXED</code>: a fixed-length byte string</li>
<li><code>RECORD</code>: a selection set, made up of potentially-omittable named fields and their values</li>
<li><code>ARRAY</code>: a variable-length list of a single type</li>
<li><code>BLOCK</code>: describes how to store the underlying type in a block of value data</li>
<li><code>NULLABLE</code>: may be null or have a value</li>
<li><code>DESC</code>: a self-describing type</li>
</ul>
<section id="sec-Self-describing-types" secid="2.3.1">
<h3><span class="spec-secid" title="link to this section"><a href="#sec-Self-describing-types">2.3.1</a></span>Self-describing types</h3>
<p><dfn id="self-describing-types"><a href="#self-describing-types" data-name="self-describing-types">Self-describing types</a></dfn> are used by Argo to encode values with types which are not known in advance (e.g. at Registration Time). Primarily, this is required to comply with the <a href="https://spec.graphql.org/October2021/#sec-Errors">GraphQL specification on Errors</a>.</p>
<ul>
<li><code>Absent</code>: marks that a value is not present (like <code>undefined</code> in JSON)</li>
<li><code>Null</code>: marks that a value is not present (like <code>null</code> in JSON)</li>
<li><code>Object</code>: an object, made up of named fields and their values</li>
<li><code>String</code>: a UTF-8 string</li>
<li><code>Boolean</code>: true or false</li>
<li><code>Int</code>: a variable-length integer</li>
<li><code>Float</code>: an IEEE 754 double-precision binary floating-point (binary64)</li>
<li><code>List</code>: a variable-length list of (potentially) mixed types</li>
</ul>
</section>
</section>
</section>
<section id="sec-Wire-schema" secid="3">
<h1><span class="spec-secid" title="link to this section"><a href="#sec-Wire-schema">3</a></span>Wire schema</h1>
<p>GraphQL uses a Schema to capture the names and types of data. GraphQL queries select a portion of data from that Schema. Given a Schema and a query on it, Argo produces a <dfn id="wire-schema"><a href="#wire-schema" data-name="wire-schema">Wire schema</a></dfn> with all the information needed to [de]serialize data powering that query against a compatible GraphQL Schema.</p>
<div id="note-df757" class="spec-note">
<a href="#note-df757">Note</a>
In a client-server architecture, GraphQL schemas frequently change on the server according to certain compatibility rules. Therefore, while Argo <em>cannot</em> assume the Schema used for serializing data is the Schema used for deserializing, it <em>does</em> assume they are compatible with each other (i.e. no <a href="https://spec.graphql.org/October2021/#sel-EALJDCAgICCAogH">breaking changes</a> have been made).</div>
<p>The wire schema is a single WireType which describes how to encode an entire payload:</p>
<div class="spec-production d2" id="WireType">
<span class="spec-nt"><a href="#WireType" data-name="WireType">WireType</a></span><div class="spec-rhs"><span class="spec-t">STRING()</span><span class="spec-t">|</span><span class="spec-t">BOOLEAN()</span><span class="spec-t">|</span><span class="spec-t">VARINT()</span><span class="spec-t">|</span><span class="spec-t">FLOAT64()</span><span class="spec-t">|</span><span class="spec-t">BYTES()</span><span class="spec-t">|</span><span class="spec-t">DESC()</span></div>
<div class="spec-rhs"><span class="spec-t">FIXED(lengthInBytes: Int)</span></div>
<div class="spec-rhs"><span class="spec-t">RECORD(fields: Field[])</span><span class="spec-t">where</span><span class="spec-t">Field(name: String, of: WireType, omittable: Boolean)</span></div>
<div class="spec-rhs"><span class="spec-t">ARRAY(of: WireType)</span></div>
<div class="spec-rhs"><span class="spec-t">BLOCK(of: WireType, key: String, dedupe: Boolean)</span></div>
<div class="spec-rhs"><span class="spec-t">NULLABLE(of: WireType)</span></div>
</div>
<section id="sec-Wire-schema-serialization" secid="3.1">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Wire-schema-serialization">3.1</a></span>Wire schema serialization</h2>
<p>A Wire schema or WireType may be serialized in JSON. It must be a JSON object of the form: <code>{"type": "typeName" ...attributes...}</code> where <code>typeName</code> is one of the <span class="spec-ref"><a href="#wire-types" data-name="wire-types">Wire types</a></span> as a string, and the attributes are as sketched in <em>WireType</em> above.</p>
<p>For example,</p>
<pre data-language="json"><code><span class="token punctuation">{</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"RECORD"</span><span class="token punctuation">,</span>
  <span class="token property">"fields"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"errors"</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"NULLABLE"</span><span class="token punctuation">,</span>
        <span class="token property">"of"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"ARRAY"</span><span class="token punctuation">,</span> <span class="token property">"of"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"DESC"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"omittable"</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This serialization may be helpful to avoid recomputing Wire schemas on the server. Other serializations may be more efficient but are out of scope here.</p>
</section>
</section>
<section id="sec-Binary-encoding" secid="4">
<h1><span class="spec-secid" title="link to this section"><a href="#sec-Binary-encoding">4</a></span>Binary encoding</h1>
<p>Argo&rsquo;s binary encoding does not include field names, self-contained information about the types of individual bytes, nor field or record separators. Therefore readers are wholly reliant on the Wire schema used when the data was encoded (or any compatible Wire schema), along with any information about custom scalar encodings.</p>
<p>Argo always uses a little-endian byte order.</p>
<section id="sec-Message" secid="4.1">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Message">4.1</a></span>Message</h2>
<p>An Argo <dfn id="message"><a href="#message" data-name="message">Message</a></dfn> consists of these concatenated parts:</p>
<ul>
<li>A variable-length <span class="spec-ref"><a href="#header" data-name="header">Header</a></span></li>
<li>0 or more concatenated <span class="spec-ref"><a href="#blocks" data-name="blocks">Blocks</a></span> containing scalar values, each prefixed by their length</li>
<li>1 <span class="spec-ref"><a href="#core" data-name="core">Core</a></span>, which contains the Message&rsquo;s structure, prefixed by its length</li>
</ul>
</section>
<section id="sec-Header" secid="4.2">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Header">4.2</a></span>Header</h2>
<p>The <dfn id="header"><a href="#header" data-name="header">Header</a></dfn> is encoded as a variable-length <em>BitSet</em>. After into a fixed bit array, each bit in the BitSet has a defined meaning described below.</p>
<p>Numbered least to most significant bits:</p>
<pre><code>0: InlineEverything
1: SelfDescribing
2: OutOfBandFieldErrors
3: NullTerminatedStrings
4: HasUserFlags
</code></pre>
<p>When a given flag is set, Argo&rsquo;s behavior is modified as described below. Each may also be referred to as a <dfn id="mode"><a href="#mode" data-name="mode">Mode</a></dfn> of operation, and the corresponding bit must be set if and only if the messages uses the corresponding Mode.</p>
<dl>
<dt><dfn id="inlineeverything"><a href="#inlineeverything" data-name="inlineeverything">InlineEverything</a></dfn></dt>
<dd>In this Mode, <span class="spec-ref"><a href="#blocks" data-name="blocks">Blocks</a></span> are omitted, along with their length prefixes. <span class="spec-ref"><a href="#core" data-name="core">Core</a></span>&lsquo;s prefix is also omitted. Instead, scalar values are written inline in <span class="spec-ref"><a href="#core" data-name="core">Core</a></span> (i.e. at the current position when they are encountered).</dd>
<dd>This generally results in smaller messages which do not compress as well. Useful when the Message will not be compressed.</dd>
</dl>
<dl>
<dt><dfn id="selfdescribing"><a href="#selfdescribing" data-name="selfdescribing">SelfDescribing</a></dfn></dt>
<dd>In this Mode, <span class="spec-ref"><a href="#core" data-name="core">Core</a></span> is written exactly as if its type were <code>DESC</code>. This makes the message value self-describing.</dd>
<dd>This generally makes the payload much larger, and is primarily useful when debugging.</dd>
</dl>
<dl>
<dt><dfn id="outofbandfielderrors"><a href="#outofbandfielderrors" data-name="outofbandfielderrors">OutOfBandFieldErrors</a></dfn></dt>
<dd>In this Mode, GraphQL <a href="https://spec.graphql.org/October2021/#sec-Errors.Field-errors">Field errors</a> are not guaranteed to be written inline, and may appear in the <code>errors</code> array, if any.</dd>
<dd>This makes it easier to convert JSON payloads to Argo after the fact, but eliminates the benefits of inline errors.</dd>
</dl>
<dl>
<dt><dfn id="nullterminatedstrings"><a href="#nullterminatedstrings" data-name="nullterminatedstrings">NullTerminatedStrings</a></dfn></dt>
<dd>In this Mode, all messages of type <code>String</code> are suffixed with a NUL byte. This byte is not included in the String&rsquo;s length, and is not considered part of the String. Other NUL bytes may still appear within each String.</dd>
<dd>This makes it possible to implement zero-copy in language environments relying on NUL-terminated strings, but generally makes the payload larger.</dd>
</dl>
<dl>
<dt><dfn id="hasuserflags"><a href="#hasuserflags" data-name="hasuserflags">HasUserFlags</a></dfn></dt>
<dd>In this Mode, the Header BitSet is followed by another variable-length BitSet called <em>UserFlags</em>. The meaning of entries in UserFlags is up to the implementation, and remain outside the scope of this specification.</dd>
<dd>This is useful to prototype custom implementations and extensions of Argo.</dd>
</dl>
</section>
<section id="sec-Blocks" secid="4.3">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Blocks">4.3</a></span>Blocks</h2>
<p>Argo <dfn id="blocks"><a href="#blocks" data-name="blocks">Blocks</a></dfn> are named contiguous blocks of encoded scalar values of the same type.</p>
<p>Each begins with a <span class="spec-ref"><a href="#label" data-name="label">Label</a></span> encoding the length of the block in bytes (not counting the length prefix).</p>
<p>Concatenated to this is every value in the block. The encoding of each value is defined below. Generally, this will not include any metadata, only values.</p>
<p>The name (or key) of each Block is not encoded in the message.</p>
</section>
<section id="sec-Core" secid="4.4">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Core">4.4</a></span>Core</h2>
<p>The <dfn id="core"><a href="#core" data-name="core">Core</a></dfn> of a Message contains the primary structure of the payload.</p>
<p>The Core is prefixed with a <span class="spec-ref"><a href="#label" data-name="label">Label</a></span> encoding the its length in bytes (not counting the length prefix). This is omitted when operating in <span class="spec-ref"><a href="#inlineeverything" data-name="inlineeverything">InlineEverything</a></span> mode.</p>
<p>The rest of the Core consists of a single value which encodes the payload. This is almost always a <code>RECORD</code> corresponding to GraphQL&rsquo;s <code>ExecutionResult</code>.</p>
</section>
<section id="sec-Label" secid="4.5">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Label">4.5</a></span>Label</h2>
<p>Argo uses a multipurpose binary marker called a <dfn id="label"><a href="#label" data-name="label">Label</a></dfn> which combines several use cases into one compact representation. A Label is written using the <em>variable-length zig-zag coding</em>. A Label is essentially a number which should be interpreted differently according to its value and the context in which it is used.</p>
<ul>
<li>For variable-length data, such as a <code>STRING</code> or <code>ARRAY</code>, non-negative values represent the length of the data that is to follow<ul>
<li>The units depend on the data: <code>STRING</code> lengths are in bytes, while <code>ARRAY</code> lengths are in entries</li>
</ul>
</li>
<li>For <code>BOOLEAN</code>s, 0 means <code>false</code> and 1 means <code>true</code></li>
<li>For <code>NULLABLE</code> values, -1 means <code>null</code></li>
<li>For <code>NULLABLE</code> values which are not <code>null</code> and are not normally prefixed by a Label, 0 means not-null<ul>
<li>Values which are prefixed by a Label even when non-nullable omit this non-null marker entirely, since we can rely on the Label&rsquo;s value to tell us it is not null</li>
</ul>
</li>
<li>For <code>NULLABLE</code> values, -3 means there was a Field Error which terminated its propogation (if any) here</li>
<li>For fields which may be omitted&mdash;such as fields that come from a selection set over a Union, and therefore may not appear at all&mdash;the value -2 is used to represent absence, called the <em>Absent Label</em></li>
<li>All other negative numbers are used for <span class="spec-ref"><a href="#backreferences" data-name="backreferences">Backreferences</a></span>: identification numbers which refer to values which appeared previously in the Message</li>
</ul>
<p>Types whose values are prefixed with a Label or are themselves a Label are called <dfn id="labeled"><a href="#labeled" data-name="labeled">Labeled</a></dfn>. For example, <code>STRING</code>, <code>ARRAY</code>, <code>BOOLEAN</code>, and all <code>NULLABLE</code> types are <span class="spec-ref"><a href="#labeled" data-name="labeled">Labeled</a></span>.</p>
<p>Types whose values are not prefixed with a Label and are not themselves a Label are called <dfn id="unlabeled"><a href="#unlabeled" data-name="unlabeled">Unlabeled</a></dfn>. For example, non-nullable <code>RECORD</code> and non-nullable <code>FLOAT64</code> are <span class="spec-ref"><a href="#unlabeled" data-name="unlabeled">Unlabeled</a></span>.</p>
<section id="sec-Primitive-Types" secid="4.5.1">
<h3><span class="spec-secid" title="link to this section"><a href="#sec-Primitive-Types">4.5.1</a></span>Primitive Types</h3>
<p>Primitive types are encoded in binary as described here.</p>
<dl>
<dt><dfn id="string"><a href="#string" data-name="string">STRING</a></dfn></dt>
<dd><code>STRING</code> values are encoded as UTF-8 and written to their <span class="spec-ref"><a href="#block" data-name="block">Block</a></span>. In <span class="spec-ref"><a href="#core" data-name="core">Core</a></span>, a <span class="spec-ref"><a href="#label" data-name="label">Label</a></span> is written which is the length of the encoded value in bytes. Typically, repeated <code>STRING</code> values may be deduplicated by instead writing a <em>backreference</em> to <span class="spec-ref"><a href="#core" data-name="core">Core</a></span>.</dd>
</dl>
<dl>
<dt><dfn id="boolean"><a href="#boolean" data-name="boolean">BOOLEAN</a></dfn></dt>
<dd><code>BOOLEAN</code> values use the value 0 for <code>false</code> and 1 for <code>true</code>, and are written as a <span class="spec-ref"><a href="#label" data-name="label">Label</a></span> to <span class="spec-ref"><a href="#core" data-name="core">Core</a></span>.</dd>
</dl>
<dl>
<dt><dfn id="varint"><a href="#varint" data-name="varint">VARINT</a></dfn></dt>
<dd><code>VARINT</code> (variable-length integer) values are written to <span class="spec-ref"><a href="#core" data-name="core">Core</a></span> and use the <em>variable-length zig-zag coding</em>.</dd>
</dl>
<dl>
<dt><dfn id="float64"><a href="#float64" data-name="float64">FLOAT64</a></dfn></dt>
<dd><code>FLOAT64</code> values are written to their <span class="spec-ref"><a href="#block" data-name="block">Block</a></span> as 8 bytes in little endian order according to IEEE 754. Nothing is written to <span class="spec-ref"><a href="#core" data-name="core">Core</a></span>.</dd>
</dl>
<dl>
<dt><dfn id="bytes"><a href="#bytes" data-name="bytes">BYTES</a></dfn></dt>
<dd>A <code>BYTES</code> is encoded as unaltered contiguous bytes and written to its <span class="spec-ref"><a href="#block" data-name="block">Block</a></span>. In <span class="spec-ref"><a href="#core" data-name="core">Core</a></span>, a <span class="spec-ref"><a href="#label" data-name="label">Label</a></span> is written which is the length of the encoded value in bytes. Typically, repeated <code>BYTES</code> values may be deduplicated by instead writing a <em>backreference</em> to <span class="spec-ref"><a href="#core" data-name="core">Core</a></span>.</dd>
</dl>
<dl>
<dt><dfn id="fixed"><a href="#fixed" data-name="fixed">FIXED</a></dfn></dt>
<dd><code>FIXED</code> values are written to their <span class="spec-ref"><a href="#block" data-name="block">Block</a></span> as bytes in little endian order. Nothing is written to <span class="spec-ref"><a href="#core" data-name="core">Core</a></span>. The number of bytes is not included in the message in any way, since it is in the <span class="spec-ref"><a href="#wire-schema" data-name="wire-schema">Wire schema</a></span>.</dd>
</dl>
<dl>
<dt><dfn id="record"><a href="#record" data-name="record">RECORD</a></dfn></dt>
<dd><code>RECORD</code> values are written as a concatenation of their <em>Fields</em> to <span class="spec-ref"><a href="#core" data-name="core">Core</a></span>. Each <em>Field</em> is written recursively in the order it appears in the <span class="spec-ref"><a href="#wire-schema" data-name="wire-schema">Wire schema</a></span>. If a Field is <em>omittable</em> and absent, it is written as the <em>Absent Label</em> If a Field is <em>omittable</em> and present, but its underyling type is <span class="spec-ref"><a href="#unlabeled" data-name="unlabeled">Unlabeled</a></span>, a non-null Label is written to <span class="spec-ref"><a href="#core" data-name="core">Core</a></span> before writing the field&rsquo;s value. The number of fields and their types are not included in the message in any way, since that is in the <span class="spec-ref"><a href="#wire-schema" data-name="wire-schema">Wire schema</a></span>.</dd>
</dl>
<dl>
<dt><dfn id="array"><a href="#array" data-name="array">ARRAY</a></dfn></dt>
<dd><code>ARRAY</code> values are written as a <span class="spec-ref"><a href="#label" data-name="label">Label</a></span> in <span class="spec-ref"><a href="#core" data-name="core">Core</a></span> which contains the <code>ARRAY</code>&lsquo;s length (in entries), followed by a concatenation of its entries recursively.</dd>
</dl>
<dl>
<dt><dfn id="block"><a href="#block" data-name="block">BLOCK</a></dfn></dt>
<dd><code>BLOCK</code> is not written to the <span class="spec-ref"><a href="#message" data-name="message">Message</a></span> directly. Instead, it modifies its underlying type, naming which block it should be written to and whether values should be deduplicated.</dd>
</dl>
<dl>
<dt><dfn id="nullable"><a href="#nullable" data-name="nullable">NULLABLE</a></dfn></dt>
<dd><code>NULLABLE</code> values are written differently depending on whether the underlying value is <span class="spec-ref"><a href="#labeled" data-name="labeled">Labeled</a></span> or <span class="spec-ref"><a href="#unlabeled" data-name="unlabeled">Unlabeled</a></span>. The value <code>null</code> is always written to <span class="spec-ref"><a href="#core" data-name="core">Core</a></span> as the <em>Null Label</em> with the value 0. If the underlying value is present and <span class="spec-ref"><a href="#labeled" data-name="labeled">Labeled</a></span>, non-null values are simply written recursively and unmodified using the underlying value&rsquo;s encoding. If the underlying value is present and <em>Unabeled</em>, first the <em>Non-null Label</em> is written to <span class="spec-ref"><a href="#core" data-name="core">Core</a></span>, then the underlying value is written recursively.</dd>
</dl>
<dl>
<dt><dfn id="desc"><a href="#desc" data-name="desc">DESC</a></dfn></dt>
<dd><code>DESC</code> values are self-describing, and primarily used to encode errors. This scheme is described in <em>Self-describing encoding</em></dd>
</dl>
<section id="sec-Self-describing-encoding" secid="4.5.1.1">
<h4><span class="spec-secid" title="link to this section"><a href="#sec-Self-describing-encoding">4.5.1.1</a></span>Self-describing encoding</h4>
<p>Argo is intended to rely on known types taken from GraphQL queries and schemas. However, the <code>errors</code> array in GraphQL is very free-form <a href="https://spec.graphql.org/October2021/#sec-Errors">as specified in the GraphQL Spec</a>. To support this, as well as to ease debugging in certain circumstances, a self-describing format is included.</p>
<p>Self-describing values frequently use a <dfn id="type-marker"><a href="#type-marker" data-name="type-marker">Type marker</a></dfn>, a <span class="spec-ref"><a href="#label" data-name="label">Label</a></span> written to <span class="spec-ref"><a href="#core" data-name="core">Core</a></span> with a predetermined value representing the type of the value to follow.</p>
<p>In the self-describing format, most values are encoded as usual, including using <span class="spec-ref"><a href="#blocks" data-name="blocks">Blocks</a></span>. However, values in this format only use up to 3 Blocks:</p>
<ul>
<li>A block with key &ldquo;String&rdquo;, used for all values marked <code>String</code></li>
<li>A block with key &ldquo;Int&rdquo;, used for all values marked <code>Int</code></li>
<li>A block with key &ldquo;Float&rdquo;, used for all values marked <code>Float</code></li>
</ul>
<div id="note-6224a" class="spec-note">
<a href="#note-6224a">Note</a>
these Blocks may also be used for non-self-describing values. This is intentional.</div>
<p>To write a <span class="spec-ref"><a href="#type-marker" data-name="type-marker">Type marker</a></span>, encode the given value as a <span class="spec-ref"><a href="#label" data-name="label">Label</a></span> and write it to <span class="spec-ref"><a href="#core" data-name="core">Core</a></span>.</p>
<p>To write a self-describing value, first map the desired value to the closest type described in <span class="spec-ref"><a href="#self-describing-types" data-name="self-describing-types">Self-describing types</a></span>. Then, write each type as below (reading follows the same pattern):</p>
<ul>
<li><code>Absent</code> (-2): marks that a value is not present (like <code>undefined</code> in JSON)</li>
<li><code>Null</code> (-1): marks that a value is not present (like <code>null</code> in JSON)</li>
<li><code>Object</code> (0): an object, made up of named fields and their values</li>
<li><code>String</code> (1): a UTF-8 string</li>
<li><code>Boolean</code> (2): true or false</li>
<li><code>Int</code> (3): a variable-length integer</li>
<li><code>Float</code> (4): an IEEE 754 double-precision binary floating-point (binary64)</li>
<li><code>List</code> (5): a variable-length list of (potentially) mixed types</li>
</ul>
<dl>
<dt><dfn id="absent--2-"><a href="#absent--2-" data-name="absent--2-">Absent (-2)</a></dfn></dt>
<dd>Written as <span class="spec-ref"><a href="#type-marker" data-name="type-marker">Type marker</a></span> -2 in <span class="spec-ref"><a href="#core" data-name="core">Core</a></span>.</dd>
</dl>
<dl>
<dt><dfn id="null--1-"><a href="#null--1-" data-name="null--1-">Null (-1)</a></dfn></dt>
<dd>Written as <span class="spec-ref"><a href="#type-marker" data-name="type-marker">Type marker</a></span> -1 in <span class="spec-ref"><a href="#core" data-name="core">Core</a></span>.</dd>
</dl>
<dl>
<dt><dfn id="boolean-false-0-"><a href="#boolean-false-0-" data-name="boolean-false-0-">Boolean false (0)</a></dfn></dt>
<dd>Written as <span class="spec-ref"><a href="#type-marker" data-name="type-marker">Type marker</a></span> 0 in <span class="spec-ref"><a href="#core" data-name="core">Core</a></span>.</dd>
</dl>
<dl>
<dt><dfn id="boolean-true-1-"><a href="#boolean-true-1-" data-name="boolean-true-1-">Boolean true (1)</a></dfn></dt>
<dd>Written as <span class="spec-ref"><a href="#type-marker" data-name="type-marker">Type marker</a></span> 1 in <span class="spec-ref"><a href="#core" data-name="core">Core</a></span>.</dd>
</dl>
<dl>
<dt><dfn id="object-2-"><a href="#object-2-" data-name="object-2-">Object (2)</a></dfn></dt>
<dd>Begins with <span class="spec-ref"><a href="#type-marker" data-name="type-marker">Type marker</a></span> 2 in <span class="spec-ref"><a href="#core" data-name="core">Core</a></span>, followed by a second <span class="spec-ref"><a href="#label" data-name="label">Label</a></span> in <span class="spec-ref"><a href="#core" data-name="core">Core</a></span> encoding the number of fields which follow. All fields follow in order, each written as a <code>STRING</code> capturing the field name (with no preceding <span class="spec-ref"><a href="#type-marker" data-name="type-marker">Type marker</a></span>), then recursively written the field&rsquo;s value using the self-describing encoding. These alternate until completion, concatenated together.</dd>
</dl>
<dl>
<dt><dfn id="list-3-"><a href="#list-3-" data-name="list-3-">List (3)</a></dfn></dt>
<dd>Begins with <span class="spec-ref"><a href="#type-marker" data-name="type-marker">Type marker</a></span> 3 in <span class="spec-ref"><a href="#core" data-name="core">Core</a></span>, followed by a second <span class="spec-ref"><a href="#label" data-name="label">Label</a></span> in <span class="spec-ref"><a href="#core" data-name="core">Core</a></span> encoding the length of the list. Each entry is then written recursively in the self-describing format, concatenated together. Note that heterogeneous types are allowed: this is important for GraphQL&rsquo;s error representation.</dd>
</dl>
<dl>
<dt><dfn id="string-4-"><a href="#string-4-" data-name="string-4-">String (4)</a></dfn></dt>
<dd>Written as <span class="spec-ref"><a href="#type-marker" data-name="type-marker">Type marker</a></span> 4 in <span class="spec-ref"><a href="#core" data-name="core">Core</a></span>, followed by a non-self-describing <code>STRING</code> with Block key &ldquo;String&rdquo;.</dd>
</dl>
<dl>
<dt><dfn id="int-5-"><a href="#int-5-" data-name="int-5-">Int (5)</a></dfn></dt>
<dd>Written as <span class="spec-ref"><a href="#type-marker" data-name="type-marker">Type marker</a></span> 5 in <span class="spec-ref"><a href="#core" data-name="core">Core</a></span>, followed by a non-self-describing <code>VARINT</code> with Block key &ldquo;Int&rdquo;.</dd>
</dl>
<dl>
<dt><dfn id="float-6-"><a href="#float-6-" data-name="float-6-">Float (6)</a></dfn></dt>
<dd>Written as <span class="spec-ref"><a href="#type-marker" data-name="type-marker">Type marker</a></span> 6 in <span class="spec-ref"><a href="#core" data-name="core">Core</a></span>, followed by a non-self-describing <code>FLOAT64</code> with Block key &ldquo;Float&rdquo;.</dd>
</dl>
</section>
</section>
</section>
<section id="sec-Backreferences" secid="4.6">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Backreferences">4.6</a></span>Backreferences</h2>
<p>Argo <dfn id="backreferences"><a href="#backreferences" data-name="backreferences">Backreferences</a></dfn> are numeric references to values which appeared previously in the Message.</p>
<p>Argo reduces data size on the wire by avoiding repeated values. Whenever a potentially-large value is read or written for the first time, it is stored in an array and given the next available backreference ID number (which is always negative). When it is next used, it can be identified by the backreference ID, eliminating the need to encode the entire value again.</p>
<div id="note-f061c" class="spec-note">
<a href="#note-f061c">Note</a>
This is similar to how lossless compression algorithms use a <a href="https://en.wikipedia.org/wiki/Huffman_coding">Huffman coding</a>, but simpler and less effective. The upshot is that Argo representations can remain small even after decompression, in contrast to JSON.</div>
<section id="sec-Write-side" secid="4.6.1">
<h3><span class="spec-secid" title="link to this section"><a href="#sec-Write-side">4.6.1</a></span>Write-side</h3>
<p>On the write-side, backreferences SHOULD be supported.</p>
<p>Before writing a response, a writer SHOULD create several lists (called <dfn id="memo-lists"><a href="#memo-lists" data-name="memo-lists">memo lists</a></dfn>, one for each type which is eligible for backreferences (see below). Then, the array for <code>String</code>s should insert the bootstrap values (see below), [TODO: and lists for all types with defaults should insert their defaults? does this break schema evolution?]. Memo lists are indexed by backreference ID, starting at -3 (the first non-reserved value) and counting down.</p>
<div class="spec-production" id="Algorithm">
<span class="spec-nt"><a href="#Algorithm" data-name="Algorithm">Algorithm</a></span><div class="spec-rhs"><span class="spec-nt"><span data-name="Whenever">Whenever</span></span><span class="spec-t">a</span><span class="spec-t">type</span><span class="spec-t">which</span><span class="spec-t">supports</span><span class="spec-t">backreferences</span><span class="spec-t">is</span><span class="spec-t">to</span><span class="spec-t">be</span><span class="spec-t">written</span><span class="spec-t">,</span><span class="spec-t">the</span><span class="spec-t">writer</span><span class="spec-nt"><span data-name="MAY">MAY</span></span><span class="spec-t">first</span><span class="spec-t">look</span><span class="spec-t">for</span><span class="spec-t">an</span><span class="spec-t">identical</span><span class="spec-t">value</span><span class="spec-t">in</span><span class="spec-t">the</span><span class="spec-t">corresponding</span><span class="spec-t">memo</span><span class="spec-t">list.</span><span class="spec-nt"><span data-name="If">If</span></span><span class="spec-t">it</span><span class="spec-t">finds</span><span class="spec-t">a</span><span class="spec-t">value</span><span class="spec-t">,</span><span class="spec-t">it</span><span class="spec-nt"><span data-name="MAY">MAY</span></span><span class="spec-t">write</span><span class="spec-t">out</span><span class="spec-t">the</span><span class="spec-t">backreference</span><span class="spec-nt"><span data-name="ID">ID</span></span><span class="spec-t">in</span><span class="spec-t">lieu</span><span class="spec-t">of</span><span class="spec-t">the</span><span class="spec-t">value</span><span class="spec-t">as</span><span class="spec-t">usual.</span><span class="spec-nt"><span data-name="If">If</span></span><span class="spec-t">it</span><span class="spec-t">does</span><span class="spec-t">not</span><span class="spec-t">,</span><span class="spec-t">or</span><span class="spec-t">if</span><span class="spec-t">it</span><span class="spec-t">chooses</span><span class="spec-t">not</span><span class="spec-t">to</span><span class="spec-t">(perhaps</span><span class="spec-t">for</span><span class="spec-t">simplicity)</span><span class="spec-t">,</span><span class="spec-t">it</span><span class="spec-t">writes</span><span class="spec-t">out</span><span class="spec-t">the</span><span class="spec-t">full</span><span class="spec-t">value</span><span class="spec-t">as</span><span class="spec-t">usual</span><span class="spec-t">(all</span><span class="spec-t">types</span><span class="spec-t">which</span><span class="spec-t">support</span><span class="spec-t">backreferences</span><span class="spec-t">begin</span><span class="spec-t">with</span><span class="spec-t">a</span><span class="spec-t">LABEL</span><span class="spec-t">).</span><span class="spec-nt"><span data-name="If">If</span></span><span class="spec-t">it</span><span class="spec-t">did</span><span class="spec-t">not</span><span class="spec-t">write</span><span class="spec-t">out</span><span class="spec-t">a</span><span class="spec-t">backreference</span><span class="spec-t">,</span><span class="spec-t">it</span><span class="spec-nt"><span data-name="MUST">MUST</span></span><span class="spec-t">increment</span><span class="spec-t">the</span><span class="spec-t">highest</span><span class="spec-t">backreference</span><span class="spec-nt"><span data-name="ID">ID</span></span><span class="spec-t">for</span><span class="spec-t">the</span><span class="spec-t">corresponding</span><span class="spec-t">type</span><span class="spec-t">,</span><span class="spec-t">typically</span><span class="spec-t">by</span><span class="spec-t">inserting</span><span class="spec-t">the</span><span class="spec-t">value</span><span class="spec-t">into</span><span class="spec-t">the</span><span class="spec-t">memo</span><span class="spec-t">list.</span></div>
</div>
<p>The writer MAY choose to write out full values when their representation is smaller than the backreference ID representation.</p>
<div id="note-2bf5e" class="spec-note">
<a href="#note-2bf5e">Note</a>
Backreference IDs are not unique across types: a backreference ID -5 refers to a different value for <code>String</code> than it does for <code>Enum</code>.</div>
</section>
<section id="sec-Read-side" secid="4.6.2">
<h3><span class="spec-secid" title="link to this section"><a href="#sec-Read-side">4.6.2</a></span>Read-side</h3>
<p>On the read-side, backreferences MUST be supported.</p>
<p>Before reading a response, a writer MUST create several lists (called <dfn id="memo-lists"><a href="#memo-lists" data-name="memo-lists">memo lists</a></dfn>, one for each type which is eligible for backreferences (see below). Then, the array for <code>String</code>s should insert the bootstrap values (see below), [TODO: and lists for all types with defaults should insert their defaults? does this break schema evolution?]. Memo lists are indexed by backreference ID, starting at -3 (the first non-reserved value) and counting down.</p>
<div class="spec-production" id="Algorithm">
<span class="spec-nt"><a href="#Algorithm" data-name="Algorithm">Algorithm</a></span><div class="spec-rhs"><span class="spec-nt"><span data-name="Whenever">Whenever</span></span><span class="spec-t">a</span><span class="spec-t">type</span><span class="spec-t">which</span><span class="spec-t">supports</span><span class="spec-t">backreferences</span><span class="spec-t">is</span><span class="spec-t">to</span><span class="spec-t">be</span><span class="spec-t">read</span><span class="spec-t">,</span><span class="spec-t">the</span><span class="spec-t">reader</span><span class="spec-t">will</span><span class="spec-t">first</span><span class="spec-t">read</span><span class="spec-t">a</span><span class="spec-t">LABEL</span><span class="spec-t">(see</span><span class="spec-t">[Labels</span><span class="spec-t">](#sec-Labels)</span><span class="spec-t">for</span><span class="spec-t">details).</span><span class="spec-nt"><span data-name="If">If</span></span><span class="spec-t">the</span><span class="spec-t">label</span><span class="spec-t">is</span><span class="spec-t">a</span><span class="spec-t">length</span><span class="spec-t">(and</span><span class="spec-t">will</span><span class="spec-t">therefore</span><span class="spec-t">be</span><span class="spec-t">followed</span><span class="spec-t">by</span><span class="spec-t">a</span><span class="spec-t">normal</span><span class="spec-t">value)</span><span class="spec-t">,</span><span class="spec-t">the</span><span class="spec-t">value</span><span class="spec-t">should</span><span class="spec-t">be</span><span class="spec-t">read</span><span class="spec-t">as</span><span class="spec-t">usual</span><span class="spec-t">,</span><span class="spec-t">then</span><span class="spec-t">stored</span><span class="spec-t">in</span><span class="spec-t">the</span><span class="spec-t">corresponding</span><span class="spec-t">memo</span><span class="spec-t">list</span><span class="spec-t">according</span><span class="spec-t">to</span><span class="spec-t">its</span><span class="spec-t">type</span><span class="spec-t">and</span><span class="spec-t">be</span><span class="spec-t">given</span><span class="spec-t">the</span><span class="spec-t">next</span><span class="spec-t">backreference</span><span class="spec-nt"><span data-name="ID">ID</span></span><span class="spec-t">.</span><span class="spec-nt"><span data-name="If">If</span></span><span class="spec-t">the</span><span class="spec-t">label</span><span class="spec-t">is</span><span class="spec-t">instead</span><span class="spec-t">a</span><span class="spec-t">backreference</span><span class="spec-t">,</span><span class="spec-t">the</span><span class="spec-t">reader</span><span class="spec-nt"><span data-name="MUST">MUST</span></span><span class="spec-t">look</span><span class="spec-t">up</span><span class="spec-t">the</span><span class="spec-t">value</span><span class="spec-t">in</span><span class="spec-t">the</span><span class="spec-t">corresponding</span><span class="spec-t">type's</span><span class="spec-t">memo</span><span class="spec-t">list</span><span class="spec-t">using</span><span class="spec-t">the</span><span class="spec-nt"><span data-name="ID">ID</span></span><span class="spec-t">and</span><span class="spec-t">yield</span><span class="spec-t">that</span><span class="spec-t">value.</span></div>
</div>
</section>
<section id="sec-Types-which-support-backreferences" secid="4.6.3">
<h3><span class="spec-secid" title="link to this section"><a href="#sec-Types-which-support-backreferences">4.6.3</a></span>Types which support backreferences</h3>
<p>In order to maintain a compact data representation, backreferences are only supported for certain types:</p>
<ul>
<li>Supported: <code>Enum</code>, <code>Object</code>, <code>Input Object</code>, <code>Interface</code>, <code>Union</code>, <code>List</code>, <code>String</code>, <code>ID</code>. Nullable <code>Int</code> and <code>Float</code> also support backreferences, even though their non-nullable counterparts do not.</li>
<li>Unsupported: <code>Int</code>, <code>Float</code>, <code>Boolean</code></li>
</ul>
<div class="spec-todo">
should we support them for optional fields? mayhap</div>
</section>
<section id="sec-Disabling-backreferences-for-a-given-type-in-a-message" secid="4.6.4">
<h3><span class="spec-secid" title="link to this section"><a href="#sec-Disabling-backreferences-for-a-given-type-in-a-message">4.6.4</a></span>Disabling backreferences for a given type in a message</h3>
<p>While many types support backreferences, checking for equality in the writer can increase serialization costs without reducing response sizes. Writers MAY therefore choose not to de-duplicate data using backreferences, and they SHOULD communicate these choices to readers using <a href="#sec-Message-flags">Message flags</a>. Writers MAY also mark these features as unused in response flags whenever they chose not to for a given response, though this may require serializing most of the message first.</p>
<p>By default, we recommend enabling backreference-based deduplication <em>only</em> for the following types in the writer:</p>
<ul>
<li><code>String</code>, <code>ID</code>, and <code>Enum</code> (all strongly recommended)</li>
<li>Any type marked with the <code>@deduplicate</code> directive in the schema or query</li>
</ul>
</section>
</section>
<section id="sec-Complex-types" secid="4.7">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Complex-types">4.7</a></span>Complex types</h2>
</section>
<section id="sec-Nullable-types" secid="4.8">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Nullable-types">4.8</a></span>Nullable types</h2>
<div class="spec-todo">
lenref. -1 value means null, -2 means error. other negatives = backrefs, other non-negatives = length, if that makes sense. the upshot is lengths don&rsquo;t need to be repeated if required. because of this, all lenrefs should probably reserve -1, -2.</div>
</section>
<section id="sec-Objects" secid="4.9">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Objects">4.9</a></span>Objects</h2>
<p>An object (technically, a <em>selection set</em>) is encoded by encoding the values of its selected fields in the order that they are selected in a query. In other words, an object is encoded as just the concatenation of the encodings of its selected fields. Field values are encoded per their schema. For example, the query:</p>
<pre id="example-f789b" class="spec-example" data-language="graphql"><a href="#example-f789b">Example № 1</a><code><span class="token keyword">type</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
  <span class="token attr-name">a</span><span class="token punctuation">:</span> <span class="token scalar">Int</span>
  <span class="token attr-name">b</span><span class="token punctuation">:</span> <span class="token scalar">String</span>
  <span class="token attr-name">c</span><span class="token punctuation">:</span> <span class="token scalar">ID</span>
<span class="token punctuation">}</span>
<span class="token keyword">query</span> <span class="token punctuation">{</span>
  <span class="token object">test</span> <span class="token punctuation">{</span>
    <span class="token property">a</span>
    <span class="token property">b</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>An instance of this record whose a field has value 27 (encoded as hex 36) and whose b field has value &ldquo;foo&rdquo; (encoded as hex bytes 06 66 6f 6f), would be encoded simply as the concatenation of these, namely the hex byte sequence: 36 06 66 6f 6f</p>
</section>
<section id="sec-Enums" secid="4.10">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Enums">4.10</a></span>Enums</h2>
<p>An enum is represented exactly as a string (or due to the lenref, a reference to a previous string).</p>
<p>Backreferences are always used for enums (i.e. there is no header flag to skip this feature). All enums share the same backreference ID space.</p>
<div id="note-c650c" class="spec-note">
<a href="#note-c650c">Note</a>
you might expect an integer representation for enums. Unfortunately, we cannot guarantee the writer&rsquo;s view of the enum type matches the reader&rsquo;s, because the schema may have changed: in the writer&rsquo;s schema, if an enum value has been added before the end, or an enum value has been removed, the reader and writer do not have enough information to agree on the correct numbering.</div>
</section>
<section id="sec-Lists" secid="4.11">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Lists">4.11</a></span>Lists</h2>
<p>Lists are encoded as a series of blocks. Each block consists of a lenref, followed by that many array items. A block with count zero indicates the end of the array. Each item is encoded per the array&rsquo;s item schema. The blocked representation permits one to read and write arrays without first fully beffering in memory, since one can start writing items without knowing the full length of the array.</p>
</section>
<section id="sec-Unions" secid="4.12">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Unions">4.12</a></span>Unions</h2>
<p>A union is encoded by first writing an int value indicating the 0-based position within the union of the schema of its value. The value is then encoded per the indicated schema within the union. [question: should we reserve 0 for null, even in non-nullable types?] For example, the union schema <code>["null","string"]</code> would encode:</p>
<ul>
<li>null as zero (the index of &ldquo;null&rdquo; in the union):</li>
<li>the string &ldquo;a&rdquo; as one (the index of &ldquo;string&rdquo; in the union, encoded as hex 02), followed by the serialized string:02 02 61</li>
</ul>
</section>
<section id="sec-Fixed" secid="4.13">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Fixed">4.13</a></span>Fixed</h2>
<p>Fixed instances are encoded using the number of bytes declared in the schema.</p>
</section>
<section id="sec-Errors" secid="4.14">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Errors">4.14</a></span>Errors</h2>
<p>Errors have a very special representation for two reasons:</p>
<ol>
<li>Errors are inlined with data</li>
<li>This makes them available for distinguishing between null and an error, and also makes their representation more compact.</li>
<li>The &ldquo;extensions&rdquo; portion of each errors object must be self-describing. This is in contrast to all other data: we don&rsquo;t know the schema/types of &ldquo;extensions&rdquo; data, and it may vary between objects.</li>
<li>Note: this spec does not allow for direction extension to error objects outside of the extensions field, even though the GraphQL spec allows for (but discourages) it. This is on the grounds that it is very easy to recover this information by simply moving it to the extensions field when migrating to this data format, and it simplifies this spec.</li>
</ol>
<p>Nullable fields are the only valid location for errors. See &ldquo;Nullable fields&rdquo; for details on how nullable fields may mark the presence of an error.</p>
<p>Error objects have this schema:</p>
<pre data-language="graphql"><code><span class="token keyword">type</span> <span class="token class-name">Location</span> <span class="token punctuation">{</span>
    <span class="token attr-name">line</span><span class="token punctuation">:</span> <span class="token scalar">Int</span><span class="token operator">!</span>
  <span class="token attr-name">column</span><span class="token punctuation">:</span> <span class="token scalar">Int</span><span class="token operator">!</span>
<span class="token punctuation">}</span>
<span class="token keyword">type</span> <span class="token class-name">Error</span> <span class="token punctuation">{</span>
    <span class="token attr-name">message</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span>
  <span class="token attr-name">location</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Location</span><span class="token operator">!</span><span class="token punctuation">]</span>
  <span class="token attr-name">path</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token scalar">String</span> <span class="token operator">|</span> <span class="token scalar">Int</span><span class="token punctuation">]</span>
  <span class="token attr-name">extensions</span><span class="token punctuation">:</span> <span class="token class-name">ExtensionsMap</span>
<span class="token punctuation">}</span>
</code></pre>
<div id="note-d2211" class="spec-note">
<a href="#note-d2211">Note</a>
that path and extensions are not representable as normal GraphQL responses:</div>
<ol>
<li>path mixes String and Int primitive values, which GraphQL forbids for data</li>
<li>extensions must be a map, and has no other restrictions. Based on path&rsquo;s behavior (which violates GraphQL&rsquo;s typing rules), this seems to include values only representable in the transport layer (like JSON, or this spec). There is no information about the extensions map in the schema or any query.</li>
</ol>
<p>Errors are encoded as an object with the schema above, ignoring the path and extensions fields. Then, the representations of path and extensions are respectively concatenated after it.</p>
<p>Path is represented on the wire as a nullable array of unions with schema: [&ldquo;string&rdquo;, &ldquo;int&rdquo;]. The reader&rsquo;s code generator may choose a helpful representation for this.</p>
<p>Extensions are more complex because they must be self-describing. They are encoded according to the following section.</p>
<p>Self-describing data for error extensions Data in extensions must be a map. This is represented as an array of key value pairs, where all keys are strings, and values are self-describing.</p>
<p>Maps, a new data type, are allowed in extensions. Maps are encoded as a series of blocks. Each block consists of a lenref value, followed by that many key/value pairs. A block with count zero indicates the end of the map.</p>
<ul>
<li>The blocked representation permits one to read and write maps larger than can be buffered in memory, since one can start writing items without knowing the full length of the map.</li>
</ul>
<p>Each key is a string. Each value is a union with the following schema: [&ldquo;Null&rdquo;, &ldquo;String&rdquo;, &ldquo;Int&rdquo;, &ldquo;Boolean&rdquo;, &ldquo;Float&rdquo;, &ldquo;List&rdquo;, &ldquo;Map&rdquo;] This tells us the type, which is then decoded as usual. Before values of List are written, an additional union marker is written to indicate the type of all following values in the list. Therefore, all lists must be homogeneous.</p>
<p>Therefore, each key/value pair is written like this: [key][value type][value] where [key] is a string as serialized everywhere, [value type] is a lenref union marker (iff it marks a List, it is then followed by a second lenref union marker marking the value type).</p>
</section>
</section>
<section id="sec-Motivation" secid="5">
<h1><span class="spec-secid" title="link to this section"><a href="#sec-Motivation">5</a></span>Motivation</h1>
<p>GraphQL typically serializes data into JSON, but GraphQL is designed to support other serializations as well. Argo is purpose-made to improve on serialization for GraphQL.</p>
<section id="sec-JSON" secid="5.1">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-JSON">5.1</a></span>JSON</h2>
<p>JSON is the standard serialization for GraphQL data. In the context of GraphQL responses, it has many strengths as well as a few weaknesses.</p>
<section id="sec-JSON.Strengths-of-JSON-" class="subsec">
<h6><a href="#sec-JSON.Strengths-of-JSON-" title="link to this subsection">Strengths of JSON:</a></h6>
<ul>
<li>Ubiquitous<ul>
<li>Many stable, high-performance implementations</li>
<li>High quality tools for working with JSON</li>
</ul>
</li>
<li>Self-describing (simple and usable even without tools)<ul>
<li>Independent of GraphQL schemas, documents, queries, and types</li>
</ul>
</li>
<li>Human-readable and machine-readable</li>
</ul>
</section>
<section id="sec-JSON.Weaknesses-of-JSON-" class="subsec">
<h6><a href="#sec-JSON.Weaknesses-of-JSON-" title="link to this subsection">Weaknesses of JSON:</a></h6>
<ul>
<li>Large data representation (relative to binary formats)<ul>
<li>Repetitive data format (e.g. field names) leads to large uncompressed sizes</li>
<li>Self-delimited self-describing data uses additional space</li>
</ul>
</li>
<li>Limited data type availability<ul>
<li>Byte string data must be &ldquo;stuffed&rdquo; into Unicode strings</li>
<li>64-bit integers don&rsquo;t work reliabily across all platforms</li>
<li>&ldquo;Stuffing&rdquo; other types into e.g. String can introduce inefficiencies</li>
</ul>
</li>
</ul>
</section>
</section>
<section id="sec-Tradeoffs" secid="5.2">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Tradeoffs">5.2</a></span>Tradeoffs</h2>
<p><strong>In most cases JSON is a great choice for GraphQL.</strong> However, it can be difficult to address the weaknesses. Primarily, these are related to performance: reducing the size of payloads, and reading and writing them quickly.</p>
<p>The value of reading and writing data quickly is self-evident. The benefits of reduced payload sizes can be somewhat more subtle:</p>
<ul>
<li>Decreased latency across the stack<ul>
<li>Most importantly, over the network<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Glossary/TCP_slow_start">TCP Slow Start</a>, <a href="https://www.rfc-editor.org/rfc/rfc9002.html#name-slow-start">QUIC Slow Start</a>, and other congestion control mechanisms mean larger first response payloads can significantly increase user-observed latency (especially on app open)</li>
<li>Dropped and retried packets are more likely with larger responses, especially over unreliable mobile connections</li>
<li>Smaller payloads transfer more quickly</li>
</ul>
</li>
<li>Time spent serializing, deserializing, and copying around data</li>
<li>Time spent cleaning up data, such as garbage collection</li>
</ul>
</li>
<li>Increased I/O throughput across the stack</li>
</ul>
</section>
<section id="sec-Argo" secid="5.3">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Argo">5.3</a></span>Argo</h2>
<p>To address the aforementioned weaknesses, Argo makes a different set of tradeoffs than JSON.</p>
<section id="sec-Argo.Strengths-of-Argo-" class="subsec">
<h6><a href="#sec-Argo.Strengths-of-Argo-" title="link to this subsection">Strengths of Argo:</a></h6>
<ul>
<li>Compact binary format<ul>
<li>Not self-describing: relies on GraphQL types instead</li>
</ul>
</li>
<li>Unusually compressible<ul>
<li>Stores data of the same type in blocks to assist compression algorithms, e.g. all Strings are stored together</li>
</ul>
</li>
<li>Maximizes re-use<ul>
<li>Deduplicates repeated values, so deserializing and converting to required types happens once</li>
</ul>
</li>
<li>Flexible type availability<ul>
<li>GraphQL scalars specify their encoding/decoding with a directive</li>
<li>Supports all GraphQL types</li>
<li>Also natively supports:<ul>
<li>Variable-length byte strings</li>
<li>Fixed-length byte strings</li>
<li>Variable-length integers</li>
</ul>
</li>
</ul>
</li>
<li>Simple to implement relative to other binary formats (e.g. protobuf, Thrift, Avro)</li>
</ul>
</section>
<section id="sec-Argo.Weaknesses-of-Argo-" class="subsec">
<h6><a href="#sec-Argo.Weaknesses-of-Argo-" title="link to this subsection">Weaknesses of Argo:</a></h6>
<ul>
<li>As of toady, reference implementation only<ul>
<li>No stable, high-performance implementations</li>
</ul>
</li>
<li>Almost no tools for debugging or analysis</li>
<li>Binary format which is not self-describing in its intended mode of operation<ul>
<li>Relatively difficult to debug or analyze without tools</li>
<li>Requires GraphQL schema and query be known</li>
</ul>
</li>
<li>Input types not supported<ul>
<li>Simpler implementation, but JSON still needed</li>
</ul>
</li>
</ul>
</section>
</section>
<section id="sec-Recommendation" secid="5.4">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Recommendation">5.4</a></span>Recommendation</h2>
<p>Overall, <strong>JSON is the best choice for most GraphQL deployments.</strong> However, Argo is a good choice for systems where performance is paramount. Please consider the tradeoffs above.</p>
</section>
</section>
<section id="sec-Design-notes" secid="6">
<h1><span class="spec-secid" title="link to this section"><a href="#sec-Design-notes">6</a></span>Design notes</h1>
<p>This section is not a part of the technical specification, but instead provides additional background and insight.</p>
<ul>
<li>Argo is intended for use with code generation, where particular queries against a schema are known at code generation time, and a codec can be generated from this information. This is not often a great fit for web clients, but is great for native clients (or servers). Web clients would need to first download the codec, and a Javascript codec is unlikely to be as performant as <code>JSON.parse</code>. This could be worked around by supporting both and downloading the codec out-of-band, then upgrading from JSON to Argo. A codec in WASM might meet performance needs. A Argo interpreter (instead of a code-generated codec) might reduce the download size. Even so, the tradeoffs are unfavorable.</li>
<li>Byte alignment (instead of bit or word alignment) was chosen primarily for ease of implementation (e.g. no need to pack together consecutive booleans) balanced against the resulting size. Most GraphQL responses are unlikely to majorly benefit from bit packing anyway, and the use cases which would are probably better off using a custom scalar binary representation.</li>
<li>Null vs. present fields are marked with <code>LABEL</code> per-field instead of using a bitmask for an entire object. This is a tad easier to implement on both sides. Bitmasks for null and non-null values made payloads larger during development, and were backed out.</li>
<li>Field Errors can be represented inline for a few reasons:<ul>
<li>In a reader, after reading a field you are guaranteed to know whether there was an error or just a null [TODO: require inline error?]</li>
<li>We know most of the <code>path</code> in the current response from our location, and do not need to write most of it explicitly, saving space [TODO: do this?]</li>
</ul>
</li>
<li>Perhaps surprisingly, <code>Enum</code>s can&rsquo;t be safely represented as small numbers, since schema evolution rules allow for changes (e.g. reordering) which would alter the number on one side but not the other.</li>
<li>Argo permits zero-copy for types which tend to be larger (<code>String</code> and <code>Bytes</code>). Low-level languages can refer to these values directly in the source buffer. The <code>NullTerminatedStrings</code> flag assists can assist here for C-style strings.</li>
<li>De-duplication is never required on the writer. This permits optimizations like repeating label/value pairs which are shorter than a backreference to a previously-seen value.</li>
<li>High-performance decoding of the VarInts is possible with <a href="https://arxiv.org/abs/1503.07387">a vectorized implementation</a></li>
<li>For large payloads with lots of duplication, the de-duplication is valuable even when the entire payload is compressed: values need not be encoded or decoded multiple times, and it can be used to avoid duplicated objects on the client side.</li>
<li>The name &ldquo;Argo&rdquo; riffs on the pronunciation of &ldquo;JSON&rdquo; as &ldquo;Jason,&rdquo; who in Greek mythology quested on a ship called the <em>Argo</em>.</li>
</ul>
<section id="sec-Ideas-which-did-not-pan-out" secid="6.1">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Ideas-which-did-not-pan-out">6.1</a></span>Ideas which did not pan out</h2>
<ul>
<li>Use bitmasks on each selection set to mark null (or absent) fields. See Design Notes for more.</li>
<li>Require all Field Errors be represented inline. This would be nice, but it makes it more difficult to convert JSON responses to Argo. Therefore, this is left as an optional feature (see the <code>OutOfBandFieldErrors</code> flag).</li>
<li>Specify a Wire type definition for ExecutionResult, particularly <code>errors</code>. Unfortunately, error paths mix string and int, which has no corresponding GraphQL type. We could serialize this all as string and convert back later.</li>
<li>Make the self-describing format able to describe the Wire format. This made things more complex.</li>
</ul>
</section>
<section id="sec-Ideas-which-were-not-pursued" secid="6.2">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Ideas-which-were-not-pursued">6.2</a></span>Ideas which were not pursued</h2>
<ul>
<li>Use Label before Floats to represent the number 0s to pad it with. Due to JSON/JS, many doubles are actually smallish Ints, which in IEEE 754 means leading with 0-bytes. This might work out on average, especially since 0 takes only 1 byte.</li>
<li>Specify how to write compact Paths to values to represent errors. A series of tags.<ul>
<li>If errors inlined, path up to propagation stop is implicit. The path from there down into any initiating non-nullable field would need to be explicit though, need to account for</li>
</ul>
</li>
<li>Whenever a default value in encountered for a scalar type which is deduplicatable, implicitly store it with a backreference ID and use it later. This may break if the schema evolves.</li>
<li>Bake in default backrefs for common strings: &lsquo;line&rsquo;, &lsquo;column&rsquo;, &lsquo;path&rsquo;. For certain small messages, this could make a difference. The extra complexity doesn&rsquo;t seem worth it though.</li>
<li>Instead of a self-describing format, simply embed JSON. This is not a knock-out win, especially for the resulting API.</li>
<li>Use a variable-length compact float format, such as <a href="https://github.com/michaeljclark/vf128">vf128</a>, <a href="https://github.com/kstenerud/compact-float">compact float</a>, or even ASN.1&rsquo;s REAL BER/DER. This would be most helpful for GraphQL APIs which return many Floats with values near zero.</li>
<li>Encode the entire <code>ExecutionResult</code>&lsquo;s type in each <span class="spec-ref"><a href="#wire-schema" data-name="wire-schema">Wire schema</a></span>, including the errors array. In particular, the user would need to provide their intended <code>extensions</code> format and stick to it, and we&rsquo;d need to fudge the type of <code>path</code> (which mixes numbers and strings in the GraphQL spec). The upshot would be total elimination of the self-describing format and the inconvenience, inefficiency, and complexity that causes.</li>
</ul>
</section>
</section>
<section id="sec-Legal" secid="7">
<h1><span class="spec-secid" title="link to this section"><a href="#sec-Legal">7</a></span>Legal</h1>
<section id="sec-Copyright-notice" secid="7.1">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Copyright-notice">7.1</a></span>Copyright notice</h2>
<p>Copyright © 2022, Michael Solomon</p>
<p>THESE MATERIALS ARE PROVIDED &ldquo;AS IS.&rdquo; The parties expressly disclaim any warranties (express, implied, or otherwise), including implied warranties of merchantability, non-infringement, fitness for a particular purpose, or title, related to the materials. The entire risk as to implementing or otherwise using the materials is assumed by the implementer and user. IN NO EVENT WILL THE PARTIES BE LIABLE TO ANY OTHER PARTY FOR LOST PROFITS OR ANY FORM OF INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES OF ANY CHARACTER FROM ANY CAUSES OF ACTION OF ANY KIND WITH RESPECT TO THIS DELIVERABLE OR ITS GOVERNING AGREEMENT, WHETHER BASED ON BREACH OF CONTRACT, TORT (INCLUDING NEGLIGENCE), OR OTHERWISE, AND WHETHER OR NOT THE OTHER MEMBER HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
</section>
<section id="sec-License" secid="7.2">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-License">7.2</a></span>License</h2>
<p>This specification is licensed under <a href="https://www.openwebfoundation.org/the-agreements/the-owf-1-0-agreements-granted-claims/owfa-1-0">OWFa 1.0</a>.</p>
</section>
</section>
<section id="sec-Formal" secid="8">
<h1><span class="spec-secid" title="link to this section"><a href="#sec-Formal">8</a></span>Formal</h1>
<section id="sec-Conformance" secid="8.1">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Conformance">8.1</a></span>Conformance</h2>
<p>A conforming implementation of Argo must fulfill all normative requirements. Conformance requirements are described in this document via both descriptive assertions and key words with clearly defined meanings.</p>
<p>The key words &ldquo;MUST&rdquo;, &ldquo;MUST NOT&rdquo;, &ldquo;REQUIRED&rdquo;, &ldquo;SHALL&rdquo;, &ldquo;SHALL NOT&rdquo;, &ldquo;SHOULD&rdquo;, &ldquo;SHOULD NOT&rdquo;, &ldquo;RECOMMENDED&rdquo;, &ldquo;MAY&rdquo;, and &ldquo;OPTIONAL&rdquo; in the normative portions of this document are to be interpreted as described in <a href="https://www.rfc-editor.org/rfc/rfc2119">IETF RFC 2119</a>. These key words may appear in lowercase and still retain their meaning unless explicitly declared as non-normative.</p>
<p>A conforming implementation of Argo may provide additional functionality, but must not where explicitly disallowed or would otherwise result in non-conformance.</p>
</section>
<section id="sec-Versioning" secid="8.2">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Versioning">8.2</a></span>Versioning</h2>
<p>Argo is versioned using <a href="https://semver.org/spec/v2.0.0.html">SemVer 2.0.0</a>. Each version of Argo explicitly targets one version of the GraphQL spec, which is usually the latest at time of writing.</p>
</section>
</section>
<section id="sec-Authors-and-contributors" secid="9">
<h1><span class="spec-secid" title="link to this section"><a href="#sec-Authors-and-contributors">9</a></span>Authors and contributors</h1>
<p>Argo was created and authored by <a href="https://msol.io">Mike Solomon</a>. </p>
</section>
<section id="index" secid="index" class="spec-index">
<h1>
<span class="spec-secid" title="link to the index"><a href="#index">§</a></span>Index</h1>
<ol>
<li><a href="#absent--2-">Absent (-2)</a></li>
<li><a href="#Algorithm">Algorithm</a></li>
<li><a href="#ArgoAlgorithm()">ArgoAlgorithm</a></li>
<li><a href="#array">ARRAY</a></li>
<li><a href="#backreferences">Backreferences</a></li>
<li><a href="#block">BLOCK</a></li>
<li><a href="#blocks">Blocks</a></li>
<li><a href="#boolean">BOOLEAN</a></li>
<li><a href="#boolean-false-0-">Boolean false (0)</a></li>
<li><a href="#boolean-true-1-">Boolean true (1)</a></li>
<li><a href="#bytes">BYTES</a></li>
<li><a href="#core">Core</a></li>
<li><a href="#desc">DESC</a></li>
<li><a href="#execution-time">Execution Time</a></li>
<li><a href="#fixed">FIXED</a></li>
<li><a href="#float-6-">Float (6)</a></li>
<li><a href="#float64">FLOAT64</a></li>
<li><a href="#graphql-types">GraphQL types</a></li>
<li><a href="#hasuserflags">HasUserFlags</a></li>
<li><a href="#header">Header</a></li>
<li><a href="#inlineeverything">InlineEverything</a></li>
<li><a href="#int-5-">Int (5)</a></li>
<li><a href="#label">Label</a></li>
<li><a href="#labeled">Labeled</a></li>
<li><a href="#list-3-">List (3)</a></li>
<li><a href="#memo-lists">memo lists</a></li>
<li><a href="#message">Message</a></li>
<li><a href="#mode">Mode</a></li>
<li><a href="#null--1-">Null (-1)</a></li>
<li><a href="#nullable">NULLABLE</a></li>
<li><a href="#nullterminatedstrings">NullTerminatedStrings</a></li>
<li><a href="#object-2-">Object (2)</a></li>
<li><a href="#outofbandfielderrors">OutOfBandFieldErrors</a></li>
<li><a href="#record">RECORD</a></li>
<li><a href="#registration-time">Registration Time</a></li>
<li><a href="#response-types">Response types</a></li>
<li><a href="#self-describing-types">Self-describing types</a></li>
<li><a href="#selfdescribing">SelfDescribing</a></li>
<li><a href="#string">STRING</a></li>
<li><a href="#string-4-">String (4)</a></li>
<li><a href="#type-marker">Type marker</a></li>
<li><a href="#unlabeled">Unlabeled</a></li>
<li><a href="#varint">VARINT</a></li>
<li><a href="#wire-schema">Wire schema</a></li>
<li><a href="#wire-types">Wire types</a></li>
<li><a href="#WireType">WireType</a></li>
</ol>
</section>
</article>
<footer>
Written in <a href="https://spec-md.com" target="_blank">Spec Markdown</a>.</footer>
<input hidden class="spec-sidebar-toggle" type="checkbox" id="spec-sidebar-toggle" aria-hidden /><label for="spec-sidebar-toggle" aria-hidden><div class="spec-sidebar-button">&#x2630;</div></label>
<div class="spec-sidebar" aria-hidden>
<div class="spec-toc">
<div class="title"><a href="#">Argo</a></div>
<ol><li id="_sidebar_1"><a href="#sec-Overview"><span class="spec-secid">1</span>Overview</a>
<input hidden class="toggle" type="checkbox" id="_toggle_1" /><label for="_toggle_1"></label>
<ol>
<li id="_sidebar_1.1"><a href="#sec-Argo-actions-at-Registration-Time"><span class="spec-secid">1.1</span>Argo actions at Registration Time</a>
<input hidden class="toggle" type="checkbox" id="_toggle_1.1" /><label for="_toggle_1.1"></label>
<ol>
<li id="_sidebar_1.1.1"><a href="#sec-Registration-time-algorithm"><span class="spec-secid">1.1.1</span>Registration time algorithm</a></li>
</ol>
</li>
<li id="_sidebar_1.2"><a href="#sec-Argo-actions-at-Execution-Time"><span class="spec-secid">1.2</span>Argo actions at Execution Time</a></li>
</ol>
</li>
<li id="_sidebar_2"><a href="#sec-Types"><span class="spec-secid">2</span>Types</a>
<input hidden class="toggle" type="checkbox" id="_toggle_2" /><label for="_toggle_2"></label>
<ol>
<li id="_sidebar_2.1"><a href="#sec-GraphQL-types"><span class="spec-secid">2.1</span>GraphQL types</a></li>
<li id="_sidebar_2.2"><a href="#sec-Response-types"><span class="spec-secid">2.2</span>Response types</a></li>
<li id="_sidebar_2.3"><a href="#sec-Wire-types"><span class="spec-secid">2.3</span>Wire types</a>
<input hidden class="toggle" type="checkbox" id="_toggle_2.3" /><label for="_toggle_2.3"></label>
<ol>
<li id="_sidebar_2.3.1"><a href="#sec-Self-describing-types"><span class="spec-secid">2.3.1</span>Self-describing types</a></li>
</ol>
</li>
</ol>
</li>
<li id="_sidebar_3"><a href="#sec-Wire-schema"><span class="spec-secid">3</span>Wire schema</a>
<input hidden class="toggle" type="checkbox" id="_toggle_3" /><label for="_toggle_3"></label>
<ol>
<li id="_sidebar_3.1"><a href="#sec-Wire-schema-serialization"><span class="spec-secid">3.1</span>Wire schema serialization</a></li>
</ol>
</li>
<li id="_sidebar_4"><a href="#sec-Binary-encoding"><span class="spec-secid">4</span>Binary encoding</a>
<input hidden class="toggle" type="checkbox" id="_toggle_4" /><label for="_toggle_4"></label>
<ol>
<li id="_sidebar_4.1"><a href="#sec-Message"><span class="spec-secid">4.1</span>Message</a></li>
<li id="_sidebar_4.2"><a href="#sec-Header"><span class="spec-secid">4.2</span>Header</a></li>
<li id="_sidebar_4.3"><a href="#sec-Blocks"><span class="spec-secid">4.3</span>Blocks</a></li>
<li id="_sidebar_4.4"><a href="#sec-Core"><span class="spec-secid">4.4</span>Core</a></li>
<li id="_sidebar_4.5"><a href="#sec-Label"><span class="spec-secid">4.5</span>Label</a>
<input hidden class="toggle" type="checkbox" id="_toggle_4.5" /><label for="_toggle_4.5"></label>
<ol>
<li id="_sidebar_4.5.1"><a href="#sec-Primitive-Types"><span class="spec-secid">4.5.1</span>Primitive Types</a>
<input hidden class="toggle" type="checkbox" id="_toggle_4.5.1" /><label for="_toggle_4.5.1"></label>
<ol>
<li id="_sidebar_4.5.1.1"><a href="#sec-Self-describing-encoding"><span class="spec-secid">4.5.1.1</span>Self-describing encoding</a></li>
</ol>
</li>
</ol>
</li>
<li id="_sidebar_4.6"><a href="#sec-Backreferences"><span class="spec-secid">4.6</span>Backreferences</a>
<input hidden class="toggle" type="checkbox" id="_toggle_4.6" /><label for="_toggle_4.6"></label>
<ol>
<li id="_sidebar_4.6.1"><a href="#sec-Write-side"><span class="spec-secid">4.6.1</span>Write-side</a></li>
<li id="_sidebar_4.6.2"><a href="#sec-Read-side"><span class="spec-secid">4.6.2</span>Read-side</a></li>
<li id="_sidebar_4.6.3"><a href="#sec-Types-which-support-backreferences"><span class="spec-secid">4.6.3</span>Types which support backreferences</a></li>
<li id="_sidebar_4.6.4"><a href="#sec-Disabling-backreferences-for-a-given-type-in-a-message"><span class="spec-secid">4.6.4</span>Disabling backreferences for a given type in a message</a></li>
</ol>
</li>
<li id="_sidebar_4.7"><a href="#sec-Complex-types"><span class="spec-secid">4.7</span>Complex types</a></li>
<li id="_sidebar_4.8"><a href="#sec-Nullable-types"><span class="spec-secid">4.8</span>Nullable types</a></li>
<li id="_sidebar_4.9"><a href="#sec-Objects"><span class="spec-secid">4.9</span>Objects</a></li>
<li id="_sidebar_4.10"><a href="#sec-Enums"><span class="spec-secid">4.10</span>Enums</a></li>
<li id="_sidebar_4.11"><a href="#sec-Lists"><span class="spec-secid">4.11</span>Lists</a></li>
<li id="_sidebar_4.12"><a href="#sec-Unions"><span class="spec-secid">4.12</span>Unions</a></li>
<li id="_sidebar_4.13"><a href="#sec-Fixed"><span class="spec-secid">4.13</span>Fixed</a></li>
<li id="_sidebar_4.14"><a href="#sec-Errors"><span class="spec-secid">4.14</span>Errors</a></li>
</ol>
</li>
<li id="_sidebar_5"><a href="#sec-Motivation"><span class="spec-secid">5</span>Motivation</a>
<input hidden class="toggle" type="checkbox" id="_toggle_5" /><label for="_toggle_5"></label>
<ol>
<li id="_sidebar_5.1"><a href="#sec-JSON"><span class="spec-secid">5.1</span>JSON</a></li>
<li id="_sidebar_5.2"><a href="#sec-Tradeoffs"><span class="spec-secid">5.2</span>Tradeoffs</a></li>
<li id="_sidebar_5.3"><a href="#sec-Argo"><span class="spec-secid">5.3</span>Argo</a></li>
<li id="_sidebar_5.4"><a href="#sec-Recommendation"><span class="spec-secid">5.4</span>Recommendation</a></li>
</ol>
</li>
<li id="_sidebar_6"><a href="#sec-Design-notes"><span class="spec-secid">6</span>Design notes</a>
<input hidden class="toggle" type="checkbox" id="_toggle_6" /><label for="_toggle_6"></label>
<ol>
<li id="_sidebar_6.1"><a href="#sec-Ideas-which-did-not-pan-out"><span class="spec-secid">6.1</span>Ideas which did not pan out</a></li>
<li id="_sidebar_6.2"><a href="#sec-Ideas-which-were-not-pursued"><span class="spec-secid">6.2</span>Ideas which were not pursued</a></li>
</ol>
</li>
<li id="_sidebar_7"><a href="#sec-Legal"><span class="spec-secid">7</span>Legal</a>
<input hidden class="toggle" type="checkbox" id="_toggle_7" /><label for="_toggle_7"></label>
<ol>
<li id="_sidebar_7.1"><a href="#sec-Copyright-notice"><span class="spec-secid">7.1</span>Copyright notice</a></li>
<li id="_sidebar_7.2"><a href="#sec-License"><span class="spec-secid">7.2</span>License</a></li>
</ol>
</li>
<li id="_sidebar_8"><a href="#sec-Formal"><span class="spec-secid">8</span>Formal</a>
<input hidden class="toggle" type="checkbox" id="_toggle_8" /><label for="_toggle_8"></label>
<ol>
<li id="_sidebar_8.1"><a href="#sec-Conformance"><span class="spec-secid">8.1</span>Conformance</a></li>
<li id="_sidebar_8.2"><a href="#sec-Versioning"><span class="spec-secid">8.2</span>Versioning</a></li>
</ol>
</li>
<li id="_sidebar_9"><a href="#sec-Authors-and-contributors"><span class="spec-secid">9</span>Authors and contributors</a></li>
<li id="_sidebar_index"><a href="#index"><span class="spec-secid">§</span>Index</a></li>
</ol>
</div>
</div>
</body>
</html>
